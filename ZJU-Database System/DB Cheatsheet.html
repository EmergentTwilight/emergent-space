
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Emergent Space">
      
      
        <meta name="author" content="Emergent Twilight">
      
      
        <link rel="canonical" href="https://note.emergenttwilight.top/ZJU-Database%20System/DB%20Cheatsheet.html">
      
      
        <link rel="prev" href="DB%2019%20Recovery%20System.html">
      
      
        <link rel="next" href="../index/cv_cg/index.html">
      
      
      <link rel="icon" href="../__srcs/images/logo-E.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Cheatsheet - Emergent Space</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../__srcs/css/banner.css">
    
      <link rel="stylesheet" href="../__srcs/css/sidebar.css">
    
      <link rel="stylesheet" href="../__srcs/css/content.css">
    
      <link rel="stylesheet" href="../__srcs/css/custom.css">
    
      <link rel="stylesheet" href="../__srcs/css/font.css">
    
      <link rel="stylesheet" href="../__srcs/css/list_callouts.css">
    
      <link rel="stylesheet" href="../__srcs/css/friend_link.css">
    
      <link rel="stylesheet" href="../__srcs/css/footer.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#relational-languages" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Emergent Space" class="md-header__button md-logo" aria-label="Emergent Space" data-md-component="logo">
      
  <img src="../__srcs/images/logo-gaussian-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Emergent Space
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cheatsheet
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EmergentTwilight/emergent-space/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    emergent-space
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index.html" class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index/dsalgo/index.html" class="md-tabs__link">
          
  
    
  
  DS/Algo.

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index/codinglang/index.html" class="md-tabs__link">
          
  
    
  
  Coding/Lang.

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index/system/index.html" class="md-tabs__link">
          
  
    
  
  System

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index/cv_cg/index.html" class="md-tabs__link">
          
  
    
  
  CV/CG

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index/others/index.html" class="md-tabs__link">
          
  
    
  
  Others

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Emergent Space" class="md-nav__button md-logo" aria-label="Emergent Space" data-md-component="logo">
      
  <img src="../__srcs/images/logo-gaussian-small.png" alt="logo">

    </a>
    Emergent Space
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EmergentTwilight/emergent-space/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    emergent-space
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Home
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../index/dsalgo/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    DS/Algo.
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../index/codinglang/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Coding/Lang.
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index/system/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    System
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../ZJU-HPC101/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    HPC101
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../ZJU-Computer%20Organization/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Computer Organization
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Database System
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Database System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2001%20Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 Introduction
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2002%20Intro%20to%20the%20Relational%20Model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 Intro to the Relational Model
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2003%20Introduction%20to%20SQL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 Introduction to SQL
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2004%20Intermediate%20SQL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 Intermediate SQL
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2005%20Advanced%20SQL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 Advanced SQL
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2006%20Database%20Design%20using%20the%20E-R%20Model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 Database Design using the E-R Model
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2007%20Relational%20Database%20Design.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 Relational Database Design
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2013%20Data%20Storage%20Structures.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13 Data Storage Structures
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2014%20Indexing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 Indexing
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2015%20Query%20Processing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15 Query Processing
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2016%20Query%20Optimization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16 Query Optimization
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2017%20Transactions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17 Transactions
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2018%20Concurrency%20Control.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18 Concurrency Control
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DB%2019%20Recovery%20System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19 Recovery System
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Cheatsheet
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="DB%20Cheatsheet.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Cheatsheet
  </span>
  
    
  
  
    <span class="md-status md-status--['archived']"></span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#relational-languages" class="md-nav__link">
    <span class="md-ellipsis">
      Relational Languages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relational Languages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relational-model" class="md-nav__link">
    <span class="md-ellipsis">
      Relational Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-example" class="md-nav__link">
    <span class="md-ellipsis">
      Final Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ddl" class="md-nav__link">
    <span class="md-ellipsis">
      DDL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dml-操作" class="md-nav__link">
    <span class="md-ellipsis">
      DML 操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dml-查询" class="md-nav__link">
    <span class="md-ellipsis">
      DML 查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcl" class="md-nav__link">
    <span class="md-ellipsis">
      DCL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      JDBC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions-and-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Functions and Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Aggregation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-design" class="md-nav__link">
    <span class="md-ellipsis">
      Database Design
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#e-r" class="md-nav__link">
    <span class="md-ellipsis">
      E-R
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalization" class="md-nav__link">
    <span class="md-ellipsis">
      Normalization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Normalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functional-dependency-theory" class="md-nav__link">
    <span class="md-ellipsis">
      Functional Dependency Theory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#根据依赖求候选键" class="md-nav__link">
    <span class="md-ellipsis">
      根据依赖求候选键
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-preserving" class="md-nav__link">
    <span class="md-ellipsis">
      dependency preserving
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bcnf" class="md-nav__link">
    <span class="md-ellipsis">
      BCNF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3nf" class="md-nav__link">
    <span class="md-ellipsis">
      3NF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4nf" class="md-nav__link">
    <span class="md-ellipsis">
      4NF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-indexing" class="md-nav__link">
    <span class="md-ellipsis">
      Storage &amp; Indexing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage & Indexing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage-storage-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Storage &amp; Storage Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexing" class="md-nav__link">
    <span class="md-ellipsis">
      Indexing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    <span class="md-ellipsis">
      Query
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Query Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selection" class="md-nav__link">
    <span class="md-ellipsis">
      Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sorting" class="md-nav__link">
    <span class="md-ellipsis">
      Sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    <span class="md-ellipsis">
      Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Other Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-of-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation of Expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Query Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#等价规则" class="md-nav__link">
    <span class="md-ellipsis">
      等价规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#成本估计" class="md-nav__link">
    <span class="md-ellipsis">
      成本估计
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transactions" class="md-nav__link">
    <span class="md-ellipsis">
      Transactions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transactions_1" class="md-nav__link">
    <span class="md-ellipsis">
      Transactions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrency-control" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrency Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrency Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lock-based-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Lock-Based Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deadlock-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-granularity" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Granularity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-delete" class="md-nav__link">
    <span class="md-ellipsis">
      Insert / Delete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vallina-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Vallina Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buffer-management" class="md-nav__link">
    <span class="md-ellipsis">
      Buffer Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzy-ckpt" class="md-nav__link">
    <span class="md-ellipsis">
      Fuzzy Ckpt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#early-lock-release-and-operation-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Early Lock Release and Operation Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aries" class="md-nav__link">
    <span class="md-ellipsis">
      ARIES
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#复习课" class="md-nav__link">
    <span class="md-ellipsis">
      复习课
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../index/cv_cg/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    CV/CG
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../index/others/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Others
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#relational-languages" class="md-nav__link">
    <span class="md-ellipsis">
      Relational Languages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relational Languages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relational-model" class="md-nav__link">
    <span class="md-ellipsis">
      Relational Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-example" class="md-nav__link">
    <span class="md-ellipsis">
      Final Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ddl" class="md-nav__link">
    <span class="md-ellipsis">
      DDL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dml-操作" class="md-nav__link">
    <span class="md-ellipsis">
      DML 操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dml-查询" class="md-nav__link">
    <span class="md-ellipsis">
      DML 查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcl" class="md-nav__link">
    <span class="md-ellipsis">
      DCL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      JDBC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions-and-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Functions and Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Aggregation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-design" class="md-nav__link">
    <span class="md-ellipsis">
      Database Design
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#e-r" class="md-nav__link">
    <span class="md-ellipsis">
      E-R
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalization" class="md-nav__link">
    <span class="md-ellipsis">
      Normalization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Normalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functional-dependency-theory" class="md-nav__link">
    <span class="md-ellipsis">
      Functional Dependency Theory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#根据依赖求候选键" class="md-nav__link">
    <span class="md-ellipsis">
      根据依赖求候选键
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-preserving" class="md-nav__link">
    <span class="md-ellipsis">
      dependency preserving
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bcnf" class="md-nav__link">
    <span class="md-ellipsis">
      BCNF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3nf" class="md-nav__link">
    <span class="md-ellipsis">
      3NF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4nf" class="md-nav__link">
    <span class="md-ellipsis">
      4NF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-indexing" class="md-nav__link">
    <span class="md-ellipsis">
      Storage &amp; Indexing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage & Indexing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage-storage-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Storage &amp; Storage Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexing" class="md-nav__link">
    <span class="md-ellipsis">
      Indexing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    <span class="md-ellipsis">
      Query
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Query Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selection" class="md-nav__link">
    <span class="md-ellipsis">
      Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sorting" class="md-nav__link">
    <span class="md-ellipsis">
      Sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    <span class="md-ellipsis">
      Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Other Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-of-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation of Expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Query Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#等价规则" class="md-nav__link">
    <span class="md-ellipsis">
      等价规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#成本估计" class="md-nav__link">
    <span class="md-ellipsis">
      成本估计
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transactions" class="md-nav__link">
    <span class="md-ellipsis">
      Transactions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transactions_1" class="md-nav__link">
    <span class="md-ellipsis">
      Transactions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrency-control" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrency Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrency Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lock-based-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Lock-Based Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deadlock-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-granularity" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Granularity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-delete" class="md-nav__link">
    <span class="md-ellipsis">
      Insert / Delete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vallina-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Vallina Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buffer-management" class="md-nav__link">
    <span class="md-ellipsis">
      Buffer Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzy-ckpt" class="md-nav__link">
    <span class="md-ellipsis">
      Fuzzy Ckpt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#early-lock-release-and-operation-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Early Lock Release and Operation Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aries" class="md-nav__link">
    <span class="md-ellipsis">
      ARIES
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#复习课" class="md-nav__link">
    <span class="md-ellipsis">
      复习课
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/EmergentTwilight/emergent-space/edit/master/docs/ZJU-Database System/DB Cheatsheet.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/EmergentTwilight/emergent-space/raw/master/docs/ZJU-Database System/DB Cheatsheet.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


  <h1>Cheatsheet</h1>

<style>
:root {
  --md-list-callouts-bg-intensity-light: 0.15;
  --md-list-callouts-bg-intensity-dark: 0.15;
  --md-list-callouts-content-padding-left: 1.2rem;
  --md-list-callouts-symbol-width: 1.25rem;
  --md-list-callouts-border-radius: 0.2rem;
}

.list-callouts {
  padding-left: var(--md-list-callouts-content-padding-left);
  border-radius: var(--md-list-callouts-border-radius);
  position: relative;
  white-space: normal;
  overflow-wrap: break-word;
}

.list-callouts::before {
  font-family: var(--md-code-font);
  font-weight: bold;
  position: absolute;
  left: 0;
  top: 0;
  width: var(--md-list-callouts-symbol-width);
  height: 100%;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  text-align: center;
  pointer-events: none;
}


/* & */
.list-callouts-highlight {
  background-color: rgba(246, 217, 67, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-highlight::before {
  content: "&";
  color: rgb(246, 217, 67);
}


/* ? */
.list-callouts-question {
  background-color: rgba(240, 151, 48, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-question::before {
  content: "?";
  color: rgb(240, 151, 48);
}


/* ! */
.list-callouts-warning {
  background-color: rgba(235, 56, 72, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-warning::before {
  content: "!";
  color: rgb(235, 56, 72);
}


/* ~ */
.list-callouts-bookmark {
  background-color: rgba(125, 73, 247, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-bookmark::before {
  content: "~";
  color: rgb(125, 73, 247);
}


/* @ */
.list-callouts-tip {
  background-color: rgba(84, 181, 209, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-tip::before {
  content: "@";
  color: rgb(84, 181, 209);
}


/* $ */
.list-callouts-success {
  background-color: rgba(83, 198, 96, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-success::before {
  content: "$";
  color: rgb(83, 198, 96);
}


/* % */
.list-callouts-quote {
  background-color: rgba(158, 158, 158, calc(var(--md-list-callouts-bg-intensity-light) * 100%));
}

.list-callouts-quote::before {
  content: "%";
  color: rgb(158, 158, 158);
}
</style>
<h2 id="relational-languages">Relational Languages<a class="headerlink" href="#relational-languages" title="Locate to heading">#</a></h2>
<h3 id="relational-model">Relational Model<a class="headerlink" href="#relational-model" title="Locate to heading">#</a></h3>
<ul>
<li>关系数据库结构<ul>
<li>relation 就是 table</li>
<li>tuple 就是行，也是 relation instance</li>
<li>attr 就是列，具有 domain，null 是一个特殊的值</li>
</ul>
</li>
<li>数据库模式，schema 是一个模式，instance 是一个快照</li>
<li>key<ul>
<li>superkey 唯一标识</li>
<li>candidate key 最小的 superkey</li>
<li>primary key 人为定义的 candidate key</li>
<li>foreign key<ul>
<li>referencing/referenced relation</li>
<li>referential integrity constraint 参照完整性约束，要求参照关系每个元素的参照属性取值必须为被参照关系上的被参照属性的取值中的一个</li>
</ul>
</li>
</ul>
</li>
<li>schema diagram：矩形，上面是表名，下面属性下划线标识 primary key，外键参照用箭头指向，和 E-R 区分，更像是化简后更接近逻辑实现的结果</li>
<li>query lang<ul>
<li>procedural lang 过程化语言，需要用户指导系统如何计算</li>
<li>nonprocedural lang 非过程化语言，用户只需要描述需要的信息</li>
<li>SQL 两者</li>
</ul>
</li>
<li>关系运算<ul>
<li>
<div class="list-callouts list-callouts-warning"><span>注意 relation 都是集合</span></div>
</li>
<li>基本运算 <span class="arithmatex">\(\sigma,\Pi,\times,\cup,-,\rho\)</span><ul>
<li><span class="arithmatex">\(\cup\)</span> 的要求<ul>
<li>attr 数量一致</li>
<li>attr domain 对应兼容</li>
</ul>
</li>
</ul>
</li>
<li>附加运算 <span class="arithmatex">\(\cap,\bowtie,\leftarrow,⟕,⟗,⟖\)</span><ul>
<li>自然连接的形式化定义 <span class="arithmatex">\(r\bowtie s=\Pi_{R\cup S}(\sigma_{r.A_1=s.A_1\land r.A_2=s.A_2\land\dots\land r.A_n=s.A_n}(r\times s))\)</span>，其中 <span class="arithmatex">\(R\cap S=\{A_1, A_2, \dots, A_n\}\)</span><ul>
<li>如果 <span class="arithmatex">\(R\cap S=\emptyset\)</span>，那么 <span class="arithmatex">\(r\bowtie s=r\times s\)</span></li>
<li>另外 <span class="arithmatex">\(r\bowtie_\theta s=\sigma_\theta(r\times s)\)</span></li>
</ul>
</li>
<li><span class="arithmatex">\(\leftarrow\)</span> 是赋值运算，例如 <span class="arithmatex">\(temp1\leftarrow R\times S\)</span></li>
<li>左右外连接都是可以用基本关系代数表示的</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="sql">SQL<a class="headerlink" href="#sql" title="Locate to heading">#</a></h3>
<ul>
<li>三种语言<ul>
<li>DDL 数据定义语言 <code>create, alter, drop, truncate, rename</code></li>
<li>DML 数据操作语言 <code>select, insert, update, delete</code></li>
<li>DCL 数据控制语言 <code>grant, revoke</code></li>
</ul>
</li>
<li>union 操作？set differenct</li>
</ul>
<h4 id="final-example">Final Example<a class="headerlink" href="#final-example" title="Locate to heading">#</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">23 春夏标答</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;male&quot;</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">name</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">followship</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">follower_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;1001&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;female&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;female&quot;</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="p">);</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="k">WITH</span><span class="w"> </span><span class="n">female_user_cnt</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span><span class="w"> </span><span class="n">cnt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">group_name</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;female&quot;</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="p">)</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">FROM</span><span class="w"> </span><span class="n">female_user_cnt</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">female_user_cnt</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">);</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">WITH</span><span class="w"> </span><span class="n">follower_cnt</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">cnt</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">follower_id</span><span class="p">)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">followship</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;game&quot;</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">cnt</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">follower_cnt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">cnt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">follower_cnt</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">22春夏</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">course</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CS&quot;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">credits</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">credits</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CS&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">);</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">course</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CS&quot;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">credits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;CS&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="p">);</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">department</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="k">FROM</span><span class="w"> </span><span class="n">course</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="p">);</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">C1</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">C2</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">C1</span><span class="p">.</span><span class="n">title</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="k">FROM</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">C1</span><span class="p">,</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">C2</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">C1</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C2</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">C1</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">C2</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="k">FROM</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">prereq</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">prereq</span><span class="o">-</span><span class="n">id</span><span class="p">)</span><span class="w">  </span><span class="c1">-- 这里的 left outer join 非常关键</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">course</span><span class="o">-</span><span class="n">id</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">20 春夏标答</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">participate</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="n">pId</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="n">sId</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">pId</span><span class="p">,</span><span class="w"> </span><span class="n">sId</span><span class="p">),</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">project</span><span class="p">(</span><span class="n">pId</span><span class="p">),</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">sId</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">student</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="k">check</span><span class="w"> </span><span class="p">(</span><span class="k">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;leader&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;member&quot;</span><span class="p">)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="p">);</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">tName</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="k">FROM</span><span class="w"> </span><span class="n">project</span><span class="p">,</span><span class="w"> </span><span class="n">teacher</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">project</span><span class="p">.</span><span class="n">tId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">teacher</span><span class="p">.</span><span class="n">tId</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="s1">&#39;2020-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2020-12-31&#39;</span><span class="p">;</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">sName</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="k">FROM</span><span class="w"> </span><span class="n">student</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">sId</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">sId</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">participate</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sId</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">20 春夏标答</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">participate</span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="n">pId</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="n">eId</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">eId</span><span class="p">,</span><span class="w"> </span><span class="n">pId</span><span class="p">),</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">project</span><span class="p">(</span><span class="n">pId</span><span class="p">),</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">eId</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employee</span><span class="p">(</span><span class="n">eId</span><span class="p">),</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="k">role</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;project manager&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;developer&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;tester&quot;</span><span class="p">))</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="p">);</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">eName</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="k">FROM</span><span class="w"> </span><span class="n">employee</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">eId</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">eId</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">participate</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">eId</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">role</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="p">);</span><span class="w">  </span><span class="c1">-- 这个非常重要</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21"></a>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">eName</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">NATURAL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">participate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">pId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;p1102&quot;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">eSalary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">eSalary</span><span class="p">)</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e1</span><span class="w"> </span><span class="k">NATURAL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">participate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p1</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">pId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;p1102&quot;</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">19 春夏标答</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">UPDATE</span><span class="w"> </span><span class="k">Comment</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">grade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">grade</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="k">WITH</span><span class="w"> </span><span class="n">movie_grade</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">avg_grade</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">Comment</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">title</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="k">FROM</span><span class="w"> </span><span class="n">movie_grade</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">avg_grade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">avg_grade</span><span class="p">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">movie_grade</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="p">);</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="k">FROM</span><span class="w"> </span><span class="k">Comment</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">title</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="k">HAVING</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">grade</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">Comment</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">title</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="p">);</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23"></a>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">movie</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="k">EXCEPT</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">movie</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">Comment</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="k">Comment</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">movie</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">user_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">user_name</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;the avenger&quot;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">grade</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">grade</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="p">);</span><span class="w">  </span><span class="c1">-- 所有减去不满足的，exist 能够检测不满足的情况</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="ddl">DDL<a class="headerlink" href="#ddl" title="Locate to heading">#</a></h4>
<ul>
<li><code>smallint</code> 机器相关的小整数</li>
<li><code>numeric(p, d)</code> 定点数，p 位数字 + 一个符号位，其中 d 位数字在小数点右侧</li>
<li><code>real, double precision</code> 浮点，双精度浮点</li>
<li><code>float(n)</code> 精度至少为 n 位的浮点数，n 代表总的位数而不是小数位</li>
<li>视图默认是非物化的，查询时才会生成，标准 SQL 无法定义物化视图</li>
<li><code>CKECK</code> 中也支持插入子查询</li>
<li>大对象类型 <code>CLOB(10KB), BLOB(2GB)</code></li>
</ul>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="n">course_id</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="n">credit</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">prereq_id</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">course_id</span><span class="p">),</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">prereq_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">course</span><span class="p">(</span><span class="n">course_id</span><span class="p">)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="n">CKECK</span><span class="w"> </span><span class="p">(</span><span class="n">semester</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Fall&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Winter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Summer&#39;</span><span class="p">))</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="p">);</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="n">textbook</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="p">);</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="p">(</span><span class="n">textbook</span><span class="p">);</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="o">&lt;</span><span class="k">constraint</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">course</span><span class="p">;</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21"></a>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">&lt;</span><span class="n">query</span><span class="w"> </span><span class="n">expression</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23"></a>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">index00</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">student</span><span class="p">(</span><span class="n">ID</span><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="dml-操作">DML 操作<a class="headerlink" href="#dml-操作" title="Locate to heading">#</a></h4>
<ul>
<li><code>CASE</code> 语句，一般都是 <code>CASE WHEN p THEN r WHEN p1 THEN r1 ELSE r2</code></li>
</ul>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;77&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;11&#39;</span><span class="p">);</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="p">(</span><span class="n">credit</span><span class="p">,</span><span class="w"> </span><span class="n">prereq_id</span><span class="p">,</span><span class="w"> </span><span class="n">course_id</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;11&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;77&#39;</span><span class="p">);</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">course_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;11&#39;</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">instructor</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">instructor</span><span class="p">);</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">course</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">course_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;11&#39;</span><span class="w"> </span><span class="n">credit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">course_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;33&#39;</span><span class="p">;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">instructor</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">instructor</span><span class="p">);</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">instructor</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CASE</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">05</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">03</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="k">END</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="dml-查询">DML 查询<a class="headerlink" href="#dml-查询" title="Locate to heading">#</a></h4>
<ul>
<li><code>SELECT ID, name, salary * 1.1</code></li>
<li><code>FROM r, s</code> 其实相当于在构造笛卡尔积 <code>CROSS JOIN</code></li>
<li>natural join: 在两个关系中都出现的属性值上取值相同，则连接<ul>
<li><code>FROM (instructor NATURAL JOIN teaches) JOIN course USING (course_id)</code> SQL 提供了一种自然丽娜姐的构造形式</li>
<li>更多用的是 <code>r JOIN s ON ...</code></li>
</ul>
</li>
<li><mark>不同的连接</mark><ul>
<li><code>NATURAL (INNER) JOIN</code>: 一般不用，因为隐藏了连接条件</li>
<li><code>INNER JOIN (JOIN)</code>: 常用，只保留匹配的</li>
<li><code>LEFT/RIGHT (OUTER) JOIN</code>: 会保留左/右没有匹配的元组，匹配 null</li>
<li><code>FULL (OUTER) JOIN</code>: 全外连接，左右没有匹配的都保留</li>
<li><code>CROSS JOIN</code>: 标准笛卡尔积，没有基于属性的匹配</li>
</ul>
</li>
<li>重命名：<code>SELECT name AS new-name FROM instructor AS I, courses AS C</code></li>
<li>字符串：<code>WHERE building LIKE '%Was\%ton%' ESCAPE '\</code><ul>
<li><code>_</code> 匹配任意字符</li>
<li><code>%</code> 匹配任意字串</li>
<li><code>___%</code> 匹配长度至少为 3 的字串</li>
<li>可以自定义转义字符，用于匹配百分号或下划线</li>
</ul>
</li>
<li><code>SELECT instructor.*, course.ID</code></li>
<li><code>ORDER BY salary DESC, name ASC</code></li>
<li><code>WHERE salary BETWEEN 90000 AD 100000</code> 或者 <code>NOT BETWEEN</code></li>
<li><code>(...) UNION (...)</code> 自动去除重复 tuple，<code>UNION ALL</code> 能保留重复</li>
<li><code>(...) INTERSECT (...)</code> 同样有 <code>INTERSECT ALL</code></li>
<li><code>(...) EXCEPT (...)</code> 同样有 <code>EXCEPT ALL</code></li>
<li><code>WHERE salary IS NULL / IS NOT NULL</code></li>
<li>聚集函数 <code>AVG, MIN, MAX, SUM, COUNT</code><ul>
<li>默认考虑重复，使用 <code>COUNT (DISTINCT ID)</code> 同一个只计算一次<ul>
<li>例如一个教师，即使教了很多门课，ID 计数也是 1</li>
</ul>
</li>
<li>控制默认不考虑</li>
<li>布尔值聚集 <code>SOME EVERY</code></li>
</ul>
</li>
<li><code>HAVING AVG(salary) &gt; 42000</code> 必须结合 <code>GROUP BY</code> 使用，具体查询流程<ul>
<li>用 from 计算出一个关系</li>
<li>应用 where 筛选条件</li>
<li>根据 group by 分组</li>
<li>如果有 having，则判断哪些组需要保留</li>
<li>最后用 select 选择需要显示的属性</li>
</ul>
</li>
<li>嵌套子查询<ul>
<li><code>IN / NOT IN</code> 判断是不是子查询结果的成员</li>
<li><code>WHERE salary &gt; SOME ( SELECT salary FROM ...)</code><ul>
<li><code>= SOME &lt;==&gt; IN, &lt;&gt; SOME &lt;==&gt; NOT IN</code></li>
<li><code>&lt;&gt; ALL &lt;==&gt; NOT IN, = ALL &lt;=/=&gt; IN</code></li>
</ul>
</li>
<li><code>WHERE EXISTS (...)</code> 判断子查询是否为空</li>
<li><code>WHERE UNIQUE (...)</code> 判断子查询中是否存在重复值</li>
</ul>
</li>
<li><code>WITH max_budget (value) AS (SELECT MAX(budget) FROM department)</code> 用 with 语句需要显式定义属性名称</li>
<li><mark>实现 <span class="arithmatex">\(\forall X, P(X)\)</span> 需要使用 <code>NOT EXISTS (&lt;query for X&gt; WHERE &lt;not P&gt;)</code>，即不存在不满足 <span class="arithmatex">\(P\)</span> 的 <span class="arithmatex">\(X\)</span></mark></li>
</ul>
<p><img alt="IMG-DB Cheatsheet-20250607155116482.webp" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250607155116482.webp" /></p>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;male&#39;</span><span class="p">;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">group_name</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="k">FROM</span><span class="w"> </span><span class="n">followship</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">followerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">userID</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">userID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1001&#39;</span><span class="p">;</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="k">WITH</span><span class="w"> </span><span class="n">female_cnt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">group_name</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;female&#39;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">group_name</span><span class="p">;</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="p">)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;female&#39;</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">group_name</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">female_cnt</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="p">);</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="k">WITH</span><span class="w"> </span><span class="n">game_follower_cnt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">userID</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">userID</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">followerID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">followship</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">userID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">userID</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;game&#39;</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">userID</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="p">)</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">userID</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">name</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="k">FROM</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">game_follower_cnt</span><span class="w"> </span><span class="k">g</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">userID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">userID</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">cnt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">game_follower_cnt</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="dcl">DCL<a class="headerlink" href="#dcl" title="Locate to heading">#</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">GRANT</span><span class="w"> </span><span class="o">&lt;</span><span class="err">权限列表</span><span class="o">&gt;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="err">关系或视图名</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">-- e.g. SELECT ON department, UPDATE (budget) ON department</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="k">TO</span><span class="w"> </span><span class="o">&lt;</span><span class="err">用户</span><span class="o">/</span><span class="err">角色列表</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="c1">-- WITH GRANT OPTION;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="k">REVOKE</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="c1">-- RESTRICT 防止级联收回</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">instructor</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="jdbc">JDBC<a class="headerlink" href="#jdbc" title="Locate to heading">#</a></h4>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">PreparedStament</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;insert into instructor values(?, ?, ?, ?)&quot;</span><span class="p">);</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;88877&quot;</span><span class="p">);</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Perry&quot;</span><span class="p">);</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="p">...</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-java highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">sql 注入</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="s">&quot;SELECT * FROM instructor WHERE name =&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X&#39; or &#39;Y&#39; = &#39;Y&quot;</span>
</span></code></pre></div></td></tr></table></div>
<p>预备语句中，会将 <code>'</code> 转义为 <code>\'</code></p>
<h4 id="functions-and-procedures">Functions and Procedures<a class="headerlink" href="#functions-and-procedures" title="Locate to heading">#</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">deptCount</span><span class="w"> </span><span class="p">(</span><span class="n">dept_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="k">RETURNS</span><span class="w"> </span><span class="n">INTERGER</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="k">BEGIN</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">d_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">d_count</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">instructor</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">instructor</span><span class="p">.</span><span class="n">dept_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dept_name</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">d_count</span><span class="p">;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="k">END</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">dept_count_proc</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">dept_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">d_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">    </span><span class="k">BEGIN</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">d_count</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">instructor</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">instructor</span><span class="p">.</span><span class="n">dept_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dept_count_proc</span><span class="p">.</span><span class="n">dept_name</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">    </span><span class="k">END</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="n">WHILE</span><span class="w"> </span><span class="o">&lt;</span><span class="nb">boolean</span><span class="w"> </span><span class="n">exp</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DO</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="w">    </span><span class="p">...</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="k">END</span><span class="w"> </span><span class="n">WHILE</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="n">REPEAT</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="w">    </span><span class="p">...</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="k">UNTIL</span><span class="w"> </span><span class="o">&lt;</span><span class="nb">boolean</span><span class="w"> </span><span class="n">exp</span><span class="o">&gt;</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="k">END</span><span class="w"> </span><span class="n">REPEAT</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26"></a>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="k">DECLARE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="k">FOR</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">budget</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">department</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">dept_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Music&#39;</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31"></a><span class="k">DO</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32"></a><span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">budget</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="k">END</span><span class="w"> </span><span class="k">FOR</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34"></a>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="k">IF</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bool</span><span class="w"> </span><span class="n">exp</span><span class="o">&gt;</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36"></a><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bool</span><span class="w"> </span><span class="n">exp</span><span class="o">&gt;</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38"></a><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="k">ELSE</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a><span class="k">END</span><span class="w"> </span><span class="k">IF</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41"></a>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">timeslot_check1</span><span class="w"> </span><span class="k">AFTER</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">section</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43"></a><span class="w">    </span><span class="k">REFERENCING</span><span class="w"> </span><span class="k">NEW</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="n">nrow</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">.</span><span class="n">time_slot_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46"></a><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">time_slot_id</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">time_slot</span><span class="p">))</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="w">    </span><span class="k">BEGIN</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="w">        </span><span class="k">ROLLBACK</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="w">    </span><span class="k">END</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="advanced-aggregation">Advanced Aggregation<a class="headerlink" href="#advanced-aggregation" title="Locate to heading">#</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">GPA</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s_rank</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="database-design">Database Design<a class="headerlink" href="#database-design" title="Locate to heading">#</a></h2>
<h3 id="e-r">E-R<a class="headerlink" href="#e-r" title="Locate to heading">#</a></h3>
<p><img alt="599x418" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613192309849.webp" /></p>
<ul>
<li>
<div class="list-callouts list-callouts-warning"><span>还是要参考笔记</span><a href="DB%2006%20Database%20Design%20using%20the%20E-R%20Model.html">DB 06 Database Design using the E-R Model</a></div>
</li>
<li>概念<ul>
<li>entity</li>
<li>entity set</li>
<li>relationship</li>
<li>relationship set</li>
<li>relationship instance</li>
<li>role</li>
<li>attr<ul>
<li>domain</li>
<li>simple / composite<ul>
<li>composite 加缩进</li>
</ul>
</li>
<li>single-valued / multivalued<ul>
<li>multivalued 用花括号括起来</li>
</ul>
</li>
<li>derived 加括号，例如 <code>age()</code></li>
</ul>
</li>
<li>mapping cardinality<ul>
<li>one-to-one</li>
<li>...</li>
<li>箭头指向的是 one</li>
<li>数字表示近的一侧</li>
</ul>
</li>
<li>weak entity set<ul>
<li>e.g. sec_course 例子<ul>
<li>section 中有 <code>sec_id</code> 节次号，<code>semester</code> 学期和 <code>year</code> 年份，但是不同课程可能有完全相同的这些属性，所以又需要 <code>course_id</code>，除此之外也需要 sec_course 形成和 course 的联系，这是所有属性构成了主键</li>
<li>但这样就出现了冗余，因为 section 中已经有 <code>course_id</code>，那么 sec_course 的联系就多余了，但是我们不希望联系隐含在关系的一个 attr 中</li>
<li>所以，删除 <code>course_id</code> 属性，此时 section 中剩余属性不足以构成主键，所以需要依附于 identifying/owner entity set course</li>
<li>总结来说，一个独立的 section 的存在依附于 course</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>转换为关系模式<ul>
<li>简单强实体集合直接用</li>
<li>复杂属性强实体集合，composite 展开，derived 删除，multivalued 多开一张表<ul>
<li>e.g. <code>instructor_phone(ID, phone)</code> ，其中两个都是主键</li>
</ul>
</li>
<li>弱实体集，加上标识集合的主键，所有属性都是主键</li>
<li>联系集合<ul>
<li>一对一，多对一，一对多，在 many 的一遍增加一个属性</li>
<li>多对多，需要新开表，存双方主键，所有属性都是主键</li>
</ul>
</li>
</ul>
</li>
<li>扩展的 E-R 属性<ul>
<li>specialization and generalization<ul>
<li>specialization: 继承/不继承</li>
<li>generalization 都是 total participation 的，低层实体一定是</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="normalization">Normalization<a class="headerlink" href="#normalization" title="Locate to heading">#</a></h3>
<ul>
<li>Lossless decomposition<ul>
<li>判断的唯一标准就是 <span class="arithmatex">\(r=r_1\bowtie r_2\)</span></li>
<li>如果满足 <span class="arithmatex">\(F^+\)</span> 中存在 <span class="arithmatex">\(R_1\cap R_2\rightarrow R_1\)</span> 或者 <span class="arithmatex">\(R_1\cap R_2\rightarrow R_2\)</span>，也满足无损分解条件，也就是说<strong>交集中含有其中一方的 superkey</strong></li>
</ul>
</li>
<li>1NF，所有 attr 都是原子的<ul>
<li>多值、复合都不是原子的</li>
</ul>
</li>
<li>functional dependency<ul>
<li><span class="arithmatex">\(\alpha\rightarrow\beta\)</span> 等价于 <span class="arithmatex">\(\forall t_1, t_2 \in r\)</span> 如果 <span class="arithmatex">\(t_1[\alpha]=t_2[\alpha]\)</span>，那么 <span class="arithmatex">\(t_1[\beta]=t_2[\beta]\)</span></li>
<li>若 <span class="arithmatex">\(K\rightarrow R\)</span> 在 <span class="arithmatex">\(r(R)\)</span> 上成立，则 <span class="arithmatex">\(K\)</span> 是一个 superkey</li>
<li>trivial 的函数依赖，即 <span class="arithmatex">\(\beta \subseteq \alpha\)</span></li>
<li><span class="arithmatex">\(F^+\)</span> 闭包，能从 <span class="arithmatex">\(F\)</span> 推导出的所有的函数依赖集合</li>
</ul>
</li>
<li>dependency preservation</li>
</ul>
<h4 id="functional-dependency-theory">Functional Dependency Theory<a class="headerlink" href="#functional-dependency-theory" title="Locate to heading">#</a></h4>
<ul>
<li>计算 <span class="arithmatex">\(F^+\)</span>，重复使用 <strong>Armstrong's Axioms</strong>, these rules are <strong>sound</strong>(正确有效的) and <strong>complete</strong>(完备的)<ul>
<li>reflexive rule (自反): if <span class="arithmatex">\(\beta\subseteq\alpha\)</span>, then <span class="arithmatex">\(\alpha\rightarrow\beta\)</span></li>
<li>augmentation rule (增补): if <span class="arithmatex">\(\alpha\rightarrow\beta\)</span>, then <span class="arithmatex">\(\gamma\alpha\rightarrow\gamma\beta\)</span></li>
<li>transitivity rule (传递): if <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> and <span class="arithmatex">\(\beta\rightarrow\gamma\)</span>, then <span class="arithmatex">\(\alpha\rightarrow\gamma\)</span></li>
<li><strong>additional rules</strong><ul>
<li>union rule (合并): if <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> and <span class="arithmatex">\(\alpha\rightarrow\gamma\)</span>, then <span class="arithmatex">\(\alpha\rightarrow\beta\gamma\)</span></li>
<li>decomposition rule (分解): if <span class="arithmatex">\(\alpha\rightarrow\beta\gamma\)</span>, then <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> and <span class="arithmatex">\(\alpha\rightarrow\gamma\)</span></li>
<li>pseudotransitivity rule (伪传递): if <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> and <span class="arithmatex">\(\gamma\beta\rightarrow\delta\)</span>, then <span class="arithmatex">\(\alpha\gamma\rightarrow\delta\)</span></li>
</ul>
</li>
</ul>
</li>
<li>计算 <span class="arithmatex">\(\alpha^+\)</span> 比较简单，而且只需要用 <span class="arithmatex">\(F\)</span> 就能得到正确的答案<ul>
<li>可以用来证明 superkey</li>
<li>然后减少任意一个元素，都得不到 <span class="arithmatex">\(R\)</span>，证明 candidate key</li>
</ul>
</li>
<li>计算 <span class="arithmatex">\(F_c\)</span><ul>
<li>extraneous attr<ul>
<li>定义：删除后不改变 <span class="arithmatex">\(F^+\)</span>，或删除后得到的 <span class="arithmatex">\(F'\)</span> 能够由 <span class="arithmatex">\(F\)</span> 推导出</li>
<li>意义：让依赖两侧的属性集合尽量小</li>
<li>验证方法，删除后在 <span class="arithmatex">\(F'\)</span> 中检查：<ul>
<li>左侧删除 <span class="arithmatex">\(A\)</span>，检查 <span class="arithmatex">\(\beta \subset(\alpha-\{A\})^+\)</span></li>
<li>右侧删除 <span class="arithmatex">\(A\)</span>，检查 <span class="arithmatex">\(A\in\alpha^+\)</span></li>
</ul>
</li>
</ul>
</li>
<li>性质：<ul>
<li><span class="arithmatex">\(F_c\)</span> 中任何函数依赖都不含无关属性</li>
<li><span class="arithmatex">\(F_c\)</span> 中依赖的左半部分都是唯一的</li>
</ul>
</li>
<li><strong>正则覆盖未必是唯一的</strong></li>
</ul>
</li>
</ul>
<h4 id="根据依赖求候选键">根据依赖求候选键<a class="headerlink" href="#根据依赖求候选键" title="Locate to heading">#</a></h4>
<ul>
<li>首先找到只在<strong>依赖左侧</strong>出现的属性，作为核心属性集 <span class="arithmatex">\(L\)</span></li>
<li>计算 <span class="arithmatex">\(L^+\)</span>，如果 <span class="arithmatex">\(L^+=R\)</span>，则 <span class="arithmatex">\(L\)</span> 是候选键，否则考虑从 <span class="arithmatex">\(R-L^+\)</span> 中添加属性</li>
</ul>
<h4 id="dependency-preserving">dependency preserving<a class="headerlink" href="#dependency-preserving" title="Locate to heading">#</a></h4>
<ul>
<li><strong>限定</strong>：将 <span class="arithmatex">\(R\)</span> 分解为 <span class="arithmatex">\(R_1, R_2,\dots,R_n\)</span>，其中 <span class="arithmatex">\(F\)</span> 在 <span class="arithmatex">\(R_i\)</span> 上的限定是 <span class="arithmatex">\(F^+\)</span> 中只包含 <span class="arithmatex">\(R_i\)</span> 中属性的子集 <span class="arithmatex">\(F_i\)</span><ul>
<li>**注意这里用的是 <span class="arithmatex">\(F^+\)</span></li>
</ul>
</li>
<li>验证依赖保持的方法<ul>
<li>如果 <span class="arithmatex">\((F_1\cup F_2\cup\dots\cup F_n)^+=F^+\)</span>，那么这个分解是依赖保持的，但是指数时间</li>
<li>或者，对于 <span class="arithmatex">\(F\)</span> 中的每个 <span class="arithmatex">\(\alpha\)</span>，依次在每个 <span class="arithmatex">\(R_i\)</span> 上并上闭包，如果都满足 <span class="arithmatex">\(\beta \subseteq result\)</span>，则也是依赖保持的，多项式时间<ul>
<li><img alt="507" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250611152126805.webp" /></li>
</ul>
</li>
</ul>
</li>
<li>需要注意 <span class="arithmatex">\(B\rightarrow CD\)</span> 这种，分成 <span class="arithmatex">\((B,C,D)\)</span> 可以，分成 <span class="arithmatex">\((B,C),(B,D)\)</span> 也可以</li>
</ul>
<h4 id="bcnf">BCNF<a class="headerlink" href="#bcnf" title="Locate to heading">#</a></h4>
<ul>
<li>具有 <span class="arithmatex">\(F\)</span> 的关系模式 <span class="arithmatex">\(R\)</span> 属于 BCNF 的条件是，对于 <span class="arithmatex">\(F^+\)</span> 中所有形如 <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> 的函数依赖，以下至少一项成立<ul>
<li><span class="arithmatex">\(\alpha\rightarrow\beta\)</span> 是平凡的</li>
<li><span class="arithmatex">\(\alpha\)</span> 是 <span class="arithmatex">\(R\)</span> 的一个 superkey</li>
</ul>
</li>
<li>分解算法<ul>
<li><span class="arithmatex">\(R\)</span> 分解为 <span class="arithmatex">\(\alpha \cup \beta\)</span> 和 <span class="arithmatex">\(R-(\beta-\alpha)\)</span></li>
<li>即将 alpha 和能够确认的部分拿出来，然后在原关系中删除 alpha 能够确认的部分</li>
</ul>
</li>
<li><strong>保证无损分解，但不能保证依赖保持</strong></li>
</ul>
<h4 id="3nf">3NF<a class="headerlink" href="#3nf" title="Locate to heading">#</a></h4>
<ul>
<li>具有 <span class="arithmatex">\(F\)</span> 的关系模式 <span class="arithmatex">\(R\)</span> 属于 BCNF 的条件是，对于 <span class="arithmatex">\(F^+\)</span> 中所有形如 <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> 的函数依赖，以下至少一项成立<ul>
<li><span class="arithmatex">\(\alpha\rightarrow\beta\)</span> 是平凡的</li>
<li><span class="arithmatex">\(\alpha\)</span> 是 <span class="arithmatex">\(R\)</span> 的一个 superkey</li>
<li><span class="arithmatex">\(\beta-\alpha\)</span> 中的每个属性 <span class="arithmatex">\(A\)</span> 都在 <span class="arithmatex">\(R\)</span> 的一个 candidate key 中 <em>放宽</em></li>
</ul>
</li>
<li>任何 BCNF 一定满足 3NF，反之不然</li>
</ul>
<p><img alt="525" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250611152551565.webp" /></p>
<ul>
<li>分解算法<ul>
<li><strong>计算正则覆盖</strong> <span class="arithmatex">\(F_c\)</span></li>
<li>直接把所有 <span class="arithmatex">\(\alpha\rightarrow\beta\)</span> 做成表 <span class="arithmatex">\(\alpha\beta\)</span></li>
<li>如果所有新表中都没有 <span class="arithmatex">\(R\)</span> 的一个 candidate key，则添加一个表保存 candidate key</li>
<li>（可选）删除被包含的冗余关系（如果使用 <span class="arithmatex">\(F\)</span> 来分解，必然有很多这种情况）</li>
</ul>
</li>
<li>3NF 能够<strong>确保无损分解和依赖保持</strong>，但是<strong>存在信息冗余</strong></li>
</ul>
<h4 id="4nf">4NF<a class="headerlink" href="#4nf" title="Locate to heading">#</a></h4>
<ul>
<li>多值情况下，满足 BCNF 不一定就没有冗余</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Definition 1</p>
<p><span class="arithmatex">\(\alpha\rightarrow\rightarrow\beta\)</span> 表示 <span class="arithmatex">\(\alpha\)</span> 多值确定了 <span class="arithmatex">\(\beta\)</span>，if 存在 <span class="arithmatex">\(t_1[\alpha]=t_2[\alpha]\)</span> 且存在 <span class="arithmatex">\(t_3, t_4\)</span> 使得：</p>
<ul>
<li><span class="arithmatex">\(t_1,t_2,t_3,t_4\)</span> 的 <span class="arithmatex">\(\alpha\)</span> 相等</li>
<li><span class="arithmatex">\(t_1,t_3\)</span> 和 <span class="arithmatex">\(t_2,t_4\)</span> 的 <span class="arithmatex">\(\beta\)</span> 相等</li>
<li><span class="arithmatex">\(t_1,t_4\)</span> 和 <span class="arithmatex">\(t_2,t_3\)</span> 的 <span class="arithmatex">\(R-\alpha-\beta\)</span> 相等</li>
<li>或者说，<span class="arithmatex">\(\beta\)</span> 和 <span class="arithmatex">\(R-\alpha-\beta\)</span> 是独立的</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Definition 2</p>
<p>或者将 <span class="arithmatex">\(R\)</span> 分解为非空的三个集合 <span class="arithmatex">\(Y,Z,W\)</span>，如果 <span class="arithmatex">\(&lt;y_1,z_1,w_1&gt;\in R \land &lt;y_1,z_2,w_2&gt;\in R\Rightarrow &lt;y_1,z_1,w_2&gt;\in R \land &lt;y_1,z_2,w_1&gt;\in R\)</span>，那么 <span class="arithmatex">\(Y\rightarrow\rightarrow Z, Y\rightarrow\rightarrow W\)</span></p>
</div>
<ul>
<li>FD 是 MVD 的特殊情况，if <span class="arithmatex">\(\alpha\rightarrow\beta\)</span>, then <span class="arithmatex">\(\alpha\rightarrow\rightarrow\beta\)</span></li>
<li>MVD 集合 <span class="arithmatex">\(D\)</span>，闭包为 <span class="arithmatex">\(D^+\)</span></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Definition</p>
<p><span class="arithmatex">\(R\)</span> is in 4NF, if <span class="arithmatex">\(\forall \alpha\rightarrow\rightarrow\beta \in D^+\)</span>:</p>
<ul>
<li><span class="arithmatex">\(\alpha\rightarrow\rightarrow\beta\)</span> is trivial</li>
<li><span class="arithmatex">\(\alpha\)</span> is a superkey for <span class="arithmatex">\(R\)</span></li>
</ul>
</div>
<ul>
<li>if R in 4NF, then R in BCNF <em>4NF 更加严格</em></li>
</ul>
<p><img alt="533" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250611153840281.webp" /></p>
<ul>
<li>基本和 BCNF 一样</li>
<li>无损分解判定<ul>
<li><span class="arithmatex">\(R_1\cap R_2\rightarrow\rightarrow R_1\in D^+\)</span> or</li>
<li><span class="arithmatex">\(R_1\cap R_2\rightarrow\rightarrow R_1\in D^+\)</span></li>
</ul>
</li>
</ul>
<h2 id="storage-indexing">Storage &amp; Indexing<a class="headerlink" href="#storage-indexing" title="Locate to heading">#</a></h2>
<h3 id="storage-storage-structure">Storage &amp; Storage Structure<a class="headerlink" href="#storage-storage-structure" title="Locate to heading">#</a></h3>
<ul>
<li>多层 memory<ul>
<li>primary memory 主存储器 cache mem</li>
<li>secondary memory 硬盘、固态硬盘 disk ssd flash</li>
<li>tertiary memory 磁带、光盘 tape cd dvd</li>
</ul>
</li>
<li>磁盘<ul>
<li><img alt="533x442" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250611211652084.webp" /><ul>
<li>磁盘臂组件，磁盘臂，读写头，主轴，盘片，磁道，扇区</li>
<li>所有第 i 条磁道构成第 i 个柱面</li>
</ul>
</li>
<li>性能评价指标<ul>
<li>access time: 发出读写请求到数据开始输出的时间<ul>
<li>average seek time: 寻道时间的平均值</li>
<li>rotational latency time: 旋转到对应的扇区的时间</li>
</ul>
</li>
<li>data-transfer rate: 数据传输率</li>
<li>MTTF: 1200 000 小时的磁盘（比较新的） 1000 张，平均 每 1200 小时坏一张</li>
</ul>
</li>
<li>性能优化<ul>
<li>顺序访问，只需要一次寻道</li>
<li>buffering</li>
<li>read-ahead</li>
<li>scheduling 磁盘臂调度 elevator algorithm</li>
<li>file organization 尽量一个文件连续放一起</li>
<li>nonvolatile write buffer</li>
<li>log disk，其所有访问都是顺序的，其文件系统称为日志文件系统</li>
</ul>
</li>
</ul>
</li>
<li>其他 memory<ul>
<li>NOR flash 存储单元并行排列，和 RAM 一样支持随机访问，可以直接读取任何字节</li>
<li>NAND flash 存储单元串行排列，主要支持顺序访问，必须先擦除整个块才能写入新数据，寿命也更低</li>
</ul>
</li>
<li>record storage<ul>
<li>fixed length<ul>
<li>可以直接计算偏移量</li>
<li>用 free list 管理空的 slot，头文件维护 free list</li>
</ul>
</li>
<li>var length<ul>
<li>出现的场景<ul>
<li>多种记录类型同文件存储</li>
<li>变长度字段，重复字段</li>
</ul>
</li>
<li>| fixed length part | null bitmap | var len part |</li>
<li>null bitmap 需要字节对齐</li>
<li>slotted page structure<ul>
<li>block header 维护 entry 数量和 entry 表，包含指向 entry 的指针</li>
<li>records 和 header 向中间生长</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>file forganization<ul>
<li>heap file organization 一条记录可以放在文件的任何地方</li>
<li>sequential file organization 根据 search key 顺序存储<ul>
<li><img alt="533x412" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250611213630112.webp" /></li>
<li>插入的时候，可能需要用指针，一段时间后需要文件重组</li>
</ul>
</li>
<li>hashing file organization 打散到多个 bucket<ul>
<li>close addressing: bucket 块满了要有溢出 bucket 块链表</li>
<li>open addressing: bucket 块满了可以放入下一个块 (linear probing)</li>
</ul>
</li>
<li>multitable cluster，多表单文件，减少 io</li>
<li>table partition</li>
<li>data dictionary storage 就是元数据的存储</li>
</ul>
</li>
<li>buffer pool<ul>
<li>buffer control workflow 当程序发出一个 page / block 请求后会发生什么<ul>
<li>hit / miss, replace</li>
</ul>
</li>
<li>buffer algorithm: LRU, MRU</li>
<li>forced output 替换之外的强制写出</li>
</ul>
</li>
<li>columnar representation<ul>
<li>利于数据分析，列统计</li>
</ul>
</li>
</ul>
<h3 id="indexing">Indexing<a class="headerlink" href="#indexing" title="Locate to heading">#</a></h3>
<ul>
<li>索引 search key</li>
<li>评价指标<ul>
<li>access type<ul>
<li>point query</li>
<li>range query</li>
</ul>
</li>
<li>access time</li>
<li>insertion time</li>
<li>deletion time</li>
<li>space overhead</li>
</ul>
</li>
<li>ordered indices<ul>
<li>primary / clustering</li>
<li>secondary / nonclustering</li>
<li>dense</li>
<li>sparse<ul>
<li>只能是 primary index，或者是 secondary index 的二级索引</li>
<li>如果被删除了，如果下一个 tuple 的 search key 不在 index 中，用下一个 tuple 的 search key 替换</li>
</ul>
</li>
<li>multilevel</li>
</ul>
</li>
<li>bptree index<ul>
<li>中间 <span class="arithmatex">\(\lceil n/2\rceil\)</span> 叶子 <span class="arithmatex">\(\lceil (n-1)/2\rceil\)</span></li>
<li>计算一定 fan-out 的树的最大最小容量<strong>例子</strong></li>
<li>分裂时，前 <span class="arithmatex">\(\lceil n/2\rceil\)</span> 放在左边</li>
<li>删除时，如果当前叶节点不满足约束，能合并则合并，否则移项</li>
<li>B+ 树 leaf 的 record 指针的位置可能发生改变，此时 B+ 树的二级索引（指向 leaf record ptr 的 ptr 索引）也需要更新</li>
<li>bulk loading: 一次插入很多项，插入前排序，则能够顺序访问叶子，每个叶子只需要一次 io</li>
<li>b tree 非叶子节点需要两倍的指针，孩子指针 + record 指针</li>
<li>多 key 索引的失效</li>
<li>covering index，储存部分属性值，而不只是 record ptr</li>
</ul>
</li>
<li>bitmap index<ul>
<li>例如 male 11010 female 00101</li>
<li>可以使用位运算加速</li>
</ul>
</li>
<li>hash index<ul>
<li>普通的不讲了</li>
<li>动态散列<ul>
<li>例如散列结果是 uint32，可以将最后几位数字作为 index</li>
<li>这样方便改变索引大小，而且没有更改 hash function，所以还是一样查询</li>
<li>性能不随文件的增长而降低</li>
</ul>
</li>
</ul>
</li>
<li>write-optimized index<ul>
<li>Log-structured merge tree<ul>
<li>结构<ul>
<li>L0 in memory B+</li>
<li>其他在 disk 中</li>
</ul>
</li>
<li>策略<ul>
<li>L0 满了就<strong>直接移动</strong>到磁盘中作为 L1</li>
<li>磁盘中每一层，低层传过来的树进行 merge，如果树的大小超过一定级别，放入新的级别</li>
<li>lazy delete，插入删除 entry，当 merge 时才进行物理删除</li>
</ul>
</li>
<li>效果<ul>
<li>优点：insert 是顺序 io，（叶子满）没有空间浪费，减少了每次插入的 io</li>
<li>缺点：query 需要搜索很多树，需要复制很多次</li>
</ul>
</li>
<li>变体 stepped-merge：每一层可以有 k 个树，然后再 merge 放入下一层<ul>
<li>减少了写开销，但是查询开销更大了</li>
</ul>
</li>
</ul>
</li>
<li>Buffer Tree<ul>
<li>每一个 internal node 都有一个 buffer 来暂存插入</li>
<li>buffer 满且还有插入时，下推到孩子的 buffer，递归</li>
<li>优点<ul>
<li>查询开销更少了</li>
<li>任何 tree-based index 都能用这种策略</li>
</ul>
</li>
<li>缺点：与 LSM 相比，进行插入时涉及下推给多个孩子，更多的 random io</li>
</ul>
</li>
<li>总结：<ul>
<li>LSM 专门做==写入==顺序化，但是查询效率比较低</li>
<li>buffer tree 减少 B+ 树就地更新的随机 io，但是仍有随机性</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="query">Query<a class="headerlink" href="#query" title="Locate to heading">#</a></h2>
<p><img alt="700x406" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613080914056.webp" /></p>
<h3 id="query-processing">Query Processing<a class="headerlink" href="#query-processing" title="Locate to heading">#</a></h3>
<ul>
<li>评价指标：传输时间和访问时间</li>
<li>优化器的目标：并不总是尽可能缩短响应时间，而是尽可能降低查询计划总的资源消耗（e.g. 还有其他查询正在进行）</li>
</ul>
<h4 id="selection">Selection<a class="headerlink" href="#selection" title="Locate to heading">#</a></h4>
<ul>
<li>A1 Linear search<ul>
<li><span class="arithmatex">\(t_S+b_rt_T\)</span></li>
</ul>
</li>
<li>A1 Linear search, equality on key<ul>
<li><span class="arithmatex">\(t_S+(b_r/2)t_T\)</span></li>
</ul>
</li>
<li>A2 B+ primary index, equality on key<ul>
<li><span class="arithmatex">\((h+1)(t_S+t_T)\)</span></li>
</ul>
</li>
<li>A3 B+ primary index, equality on non-kyey<ul>
<li><span class="arithmatex">\(h(t_S+t_T)+t_S+bt_T\)</span></li>
</ul>
</li>
<li>A4 B+ secondary index, equality on key<ul>
<li><span class="arithmatex">\((h+1)(t_T+t_S)\)</span></li>
</ul>
</li>
<li>A4 B+ secondary index, equality on non-key<ul>
<li><span class="arithmatex">\((h+n)(t_T+t_S)\)</span></li>
<li>其中 n 是 matching record 数量</li>
</ul>
</li>
<li>A5 B+ primary index, comparison<ul>
<li><span class="arithmatex">\(h(t_S+t_T)+t_S+bt_T\)</span></li>
</ul>
</li>
<li>A6 B+ secondary index, comparison<ul>
<li><span class="arithmatex">\((h+n)(t_S+t_T)\)</span></li>
<li>linear scan may be cheaper</li>
</ul>
</li>
<li>A7 conjunctive selection using one index<ul>
<li>选择一个 <span class="arithmatex">\(\theta_i\)</span> 组合，使用 A1-A7，使得这次查询操作代价最小，将符合的都读入 memory</li>
<li>然后进行其他条件的验证</li>
</ul>
</li>
<li>A8 conjunctive selection using composite index<ul>
<li>尽量使用合适的多值索引</li>
</ul>
</li>
<li>A9 conjunctive selection by intersection of identifiers<ul>
<li>先尽量使用索引得到所有条件的 matching records 指针</li>
<li>然后取交集</li>
</ul>
</li>
<li>A10 disjunctive selection by union of identifiers<ul>
<li><mark>仅在所有条件都有可用索引的时候适用</mark>，否则 linear scan 更好</li>
<li>查到 ptr 之后取并集</li>
</ul>
</li>
<li>A? negation<ul>
<li>如果满足条件的非常多，使用 linear scan</li>
<li>如果满足条件的非常少，使用 index</li>
</ul>
</li>
<li>bitmap index scan<ul>
<li>每一页一个 bit 表示</li>
<li>将 secondary index scan 的取页性能尽可能逼近 linear scan，没有非常差的性能</li>
<li>用 index 找到 matching record ptr，将指向的页置为 1</li>
<li>只取 bitmap 中 1 的页</li>
</ul>
</li>
</ul>
<h4 id="sorting">Sorting<a class="headerlink" href="#sorting" title="Locate to heading">#</a></h4>
<ul>
<li>algorithm<ul>
<li>创建 <span class="arithmatex">\(N\)</span> 个大小为 <span class="arithmatex">\(M\)</span> 的 run，<span class="arithmatex">\(N=\lceil b_r/M\rceil\)</span></li>
<li>进行 <span class="arithmatex">\(\min(N, M)\)</span> way merge<ul>
<li>如果 <span class="arithmatex">\(N&lt;M\)</span>，可以只用 merge 一次</li>
<li>否则，考虑缓冲区大小为 <span class="arithmatex">\(b_b\)</span>，则 merge <span class="arithmatex">\(\lceil\log_{\lfloor M/b_b\rfloor -1} b_r/M\rceil\)</span> 轮</li>
</ul>
</li>
</ul>
</li>
<li>cost<ul>
<li>seek<ul>
<li>初始归并段 <span class="arithmatex">\(2\lceil b_r/M\rceil\)</span></li>
<li>merge <span class="arithmatex">\(\lceil b_r/b_b\rceil(2\lceil\log_{\lfloor M/b_b\rfloor -1} b_r/M\rceil-1)\)</span><ul>
<li>每一轮寻道 2 次，除了最后一轮不需要写回</li>
</ul>
</li>
<li>总计 <span class="arithmatex">\(2\lceil b_r/M\rceil+\lceil b_r/b_b\rceil(2\lceil\log_{\lfloor M/b_b\rfloor -1} b_r/M\rceil-1)\)</span></li>
</ul>
</li>
<li>transfer<ul>
<li><span class="arithmatex">\(b_r(2\lceil\log_{\lfloor M/b_b\rfloor -1} b_r/M\rceil+1)\)</span></li>
<li>初始 2，最后 -1，所以 +1</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="join">Join<a class="headerlink" href="#join" title="Locate to heading">#</a></h4>
<p><span class="arithmatex">\(r\bowtie_\theta s\)</span></p>
<h5 id="nested-loop-join">Nested-loop Join<a class="headerlink" href="#nested-loop-join" title="Locate to heading">#</a></h5>
<ul>
<li>best case: 内存完全装下<ul>
<li><span class="arithmatex">\(2\)</span> seeks</li>
<li><span class="arithmatex">\(b_r+b_s\)</span> transfers</li>
</ul>
</li>
<li>worst case: 只有两个 buffer block 可以用来放两个关系<ul>
<li><span class="arithmatex">\(b_r+n_r\)</span> seeks</li>
<li><span class="arithmatex">\(b_r+n_rb_s\)</span> transfers</li>
</ul>
</li>
<li>总结：如果小的关系能完全放入内存，将其作为内关系</li>
</ul>
<h5 id="block-nested-loop-join">Block Nested-loop Join<a class="headerlink" href="#block-nested-loop-join" title="Locate to heading">#</a></h5>
<ul>
<li>best case<ul>
<li><span class="arithmatex">\(2\)</span> seeks</li>
<li><span class="arithmatex">\(b_r+b_s\)</span> transfers</li>
</ul>
</li>
<li>worst case: 只能放 2 个 block<ul>
<li><span class="arithmatex">\(b_r+b_s\)</span> seeks</li>
<li><span class="arithmatex">\(b_r+b_rb_s\)</span> transfers</li>
</ul>
</li>
<li>cost: 假设有 <span class="arithmatex">\(M-1\)</span> 个块可以使用，用 <span class="arithmatex">\(M-2\)</span> 个来存放外关系，外循环次数 <span class="arithmatex">\(\lceil b_r/(M-2)\rceil\)</span><ul>
<li><span class="arithmatex">\(2\lceil b_r/(M-2)\rceil\)</span> seeks</li>
<li><span class="arithmatex">\(\lceil b_r/(M-2)\rceil b_s+b_r\)</span> transfers</li>
</ul>
</li>
<li>总结：外关系尽量小有好处</li>
</ul>
<h5 id="indexed-nested-loop-join">Indexed Nested-loop Join<a class="headerlink" href="#indexed-nested-loop-join" title="Locate to heading">#</a></h5>
<ul>
<li>适用场景：如果是 equi-join 或 natural join，且内关系的 join attr 上有 index</li>
<li>对于每一个 outer 中的 tuple 都用 index 查 inner 中对应的元组</li>
<li>cost<ul>
<li><span class="arithmatex">\(b_r+n_rc_S\)</span> seeks，其中 <span class="arithmatex">\(c_S\)</span> 是内部元组使用 index 的寻道次数</li>
<li><span class="arithmatex">\(b_r+n_rc_T\)</span> transfers，其中 <span class="arithmatex">\(c_T\)</span> 是内部元组 index 的块传输次数</li>
<li>总共 <span class="arithmatex">\(b_r(t_T+t_S)+n_rc\)</span></li>
</ul>
</li>
<li>总结：如果两个关系都有对用的索引，使用元组较少的作为外关系</li>
</ul>
<h5 id="merge-join">Merge-Join<a class="headerlink" href="#merge-join" title="Locate to heading">#</a></h5>
<ul>
<li>只能用于 equi-join 和 natrual join</li>
<li>algo<ul>
<li>将两张表按照 join attr 排序（这里假设已经排序好了）</li>
<li>双指针法，找到满足等值条件的 tuple</li>
</ul>
</li>
<li>cost，假设缓冲区大小为 <span class="arithmatex">\(b_b\)</span><ul>
<li><span class="arithmatex">\(\lceil b_r/b_b\rceil+\lceil b_s/b_b\rceil\)</span> seeks</li>
<li><span class="arithmatex">\(b_r+b_s\)</span> transfers</li>
</ul>
</li>
<li>hybrid merge join<ul>
<li>一个关系按照 join attr 排序好了，另一个有 secondary index，也可以用</li>
</ul>
</li>
</ul>
<h5 id="hash-join">Hash Join<a class="headerlink" href="#hash-join" title="Locate to heading">#</a></h5>
<ul>
<li>algo<ul>
<li>partition s using hash func h, memory 中有 output buffer</li>
<li>partition r similarly</li>
<li>for i in range(0, <span class="arithmatex">\(n_h\)</span>)<ul>
<li>加载 <span class="arithmatex">\(s_i\)</span> 到内存，<strong>使用另一个 hash func 建立内存中的索引</strong></li>
<li>一个一个读 <span class="arithmatex">\(r_i\)</span>，用 hash 找 matching tuple，输出连接</li>
</ul>
</li>
<li>s 称为 build input，r 称为 probe input</li>
</ul>
</li>
<li>基本原则<ul>
<li><span class="arithmatex">\(n=\lceil b_s/M\rceil * f\)</span>，保证每个 s 的划分都能放入内存，给 20% 左右的冗余，即 <span class="arithmatex">\(f=1.2\)</span><ul>
<li>
<div class="list-callouts list-callouts-warning"><span>如果分配 M-1 个够的话，就分配 M-1 个，一般性能更好</span></div>
</li>
</ul>
</li>
<li>r 的划分不需要能够放入内存</li>
<li>如果 <span class="arithmatex">\(n\geq M\)</span>，一次划分就没有足够的缓冲区数量，需要递归划分<ul>
<li>递归划分，每次最多能将一个划分为 <span class="arithmatex">\(M-1\)</span> 个，所以需要划分 <span class="arithmatex">\(\lceil \log_{M-1} n\rceil=\lceil \log_{M-1}b_s/M\rceil\)</span> 次，这里直接假设划分完全均匀</li>
</ul>
</li>
<li>解决 overflow 问题，即划分的过程中发现一个 bucket 实际上超过了内存大小（skew hash），可以递归一次</li>
</ul>
</li>
<li>cost<ul>
<li>不递归<ul>
<li><span class="arithmatex">\(2(\lceil b_r/b_b\rceil+\lceil b_s/b_b\rceil)+2n_h\)</span> seeks，忽略了最后阶段的少量 seek</li>
<li><span class="arithmatex">\(3(b_r+b_s)+4n_h\)</span> transfers，考虑了可能存在的一张表划分之后多了 <span class="arithmatex">\(n_h\)</span> 个 block 的问题，两张表，且写入再读出</li>
</ul>
</li>
<li>递归<ul>
<li><span class="arithmatex">\(2(\lceil b_r/b_b\rceil+\lceil b_s/b_b\rceil)\lceil \log_{\lfloor M/b_b\rfloor-1}b_s/M\rceil\)</span> seeks</li>
<li><span class="arithmatex">\(2(b_r+ b_s)\lceil \log_{\lfloor M/b_b\rfloor-1}b_s/M\rceil+b_r+b_s\)</span></li>
</ul>
</li>
<li>如果整个 s 能被放入主存，直接构建 in-mem index，然后遍历 r 来 probe<ul>
<li><span class="arithmatex">\(2\)</span> seeks</li>
<li><span class="arithmatex">\(b_r+b_s\)</span> transfers</li>
</ul>
</li>
</ul>
</li>
<li>hybrid hash join<ul>
<li>当内存较大，但 s 仍然大于内存时，可以在内存中保留 s 的第一个分区，给 r 分块时直接进行探测</li>
<li>当 <span class="arithmatex">\(M&gt;&gt;\sqrt{b_s}\)</span> 时比较有用</li>
</ul>
</li>
</ul>
<h5 id="complex-joins">Complex Joins<a class="headerlink" href="#complex-joins" title="Locate to heading">#</a></h5>
<ul>
<li>交集选择<ul>
<li>使用 block nested loop</li>
<li>或者先计算 <span class="arithmatex">\(r\bowtie_{\theta_i} s\)</span>，然后不断筛选其他条件</li>
</ul>
</li>
<li>并集选择<ul>
<li>使用 block nested loop</li>
<li>或者分别计算所有的 <span class="arithmatex">\(r\bowtie_{\theta_i}s\)</span>，然后求交集</li>
</ul>
</li>
</ul>
<h4 id="other-operations">Other Operations<a class="headerlink" href="#other-operations" title="Locate to heading">#</a></h4>
<ul>
<li>duplicate elimination<ul>
<li>排序去重、hash 去重</li>
</ul>
</li>
<li>projection<ul>
<li>广义投影操作很容易出现重复，需要去重</li>
</ul>
</li>
<li>set operations<ul>
<li>对于排好序的集合，可以直接 O(N) 扫描</li>
<li>如果没有排好序，可以用 hash 实现</li>
</ul>
</li>
<li>outer join</li>
</ul>
<h4 id="evaluation-of-expressions">Evaluation of Expressions<a class="headerlink" href="#evaluation-of-expressions" title="Locate to heading">#</a></h4>
<ul>
<li>物化 or 流水线</li>
<li>物化<ul>
<li>存储中间结果</li>
<li>double buffering：两个 output buffer，当一个满了就写，另一个继续工作</li>
</ul>
</li>
<li>流水线<ul>
<li>需求驱动<ul>
<li>迭代器，open next close</li>
</ul>
</li>
<li>生产者驱动<ul>
<li>底层持续输出，直到缓冲区满，等待上级处理</li>
</ul>
</li>
</ul>
</li>
<li>blocking operations: 在所有 input 都处理之前无法生成 outpu，例如 aggr sorting</li>
</ul>
<h3 id="query-optimization">Query Optimization<a class="headerlink" href="#query-optimization" title="Locate to heading">#</a></h3>
<h4 id="等价规则">等价规则<a class="headerlink" href="#等价规则" title="Locate to heading">#</a></h4>
<details class="note">
<summary>Note</summary>
<p><img alt="700x361" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613101957245.webp" /></p>
<p><img alt="700x360" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613102003653.webp" /></p>
<p><img alt="700x279" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613102048680.webp" /></p>
<p><img alt="700x357" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613102146043.webp" /></p>
<p><img alt="700x525" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613102300110.webp" /></p>
<p><img alt="700x518" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613102405890.webp" /></p>
<p><img alt="700x411" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613102534314.webp" /></p>
</details>
<ul>
<li>启发式优化方法<ul>
<li>先进行选择，且要考虑选择条件分别作用在哪张表上</li>
<li>先进行投影</li>
<li>join 顺序<ul>
<li>确保先 join 的结果不要太大</li>
<li>e.g. (instructor from music dept <strong>join</strong> teaches) <strong>join</strong> courses</li>
</ul>
</li>
<li>eval 优化<ul>
<li>公共子表达式，动态规划</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="成本估计">成本估计<a class="headerlink" href="#成本估计" title="Locate to heading">#</a></h4>
<ul>
<li>符号表示<ul>
<li><span class="arithmatex">\(l_r\)</span> 一个元组的字节大小</li>
<li><span class="arithmatex">\(f_r\)</span> blocking factor，一个 block 能够存储的元组数量</li>
<li><span class="arithmatex">\(V(A,r)\)</span> 出现在 <span class="arithmatex">\(r\)</span> 中属性 <span class="arithmatex">\(A\)</span> 的唯一值的数量，大小和 <span class="arithmatex">\(\Pi_A(r)\)</span> 一致</li>
</ul>
</li>
<li>直方图<ul>
<li>等宽 1-3 4-6</li>
<li>等深 1-5 6-8... 找到每一个大小相似的小部分的上下界<ul>
<li>更好的估计</li>
<li>更少的空间占用</li>
<li>更推荐使用</li>
</ul>
</li>
<li>如果没有直方图，优化器就假设是均匀分布的</li>
</ul>
</li>
</ul>
<h5 id="select-size">Select Size<a class="headerlink" href="#select-size" title="Locate to heading">#</a></h5>
<ul>
<li><span class="arithmatex">\(A=a\)</span><ul>
<li>假设均匀分布 <span class="arithmatex">\(n_r/V(A,r)\)</span></li>
<li>有直方图，<span class="arithmatex">\(n_r\)</span> 用所在范围内的元组数量统计，<span class="arithmatex">\(V\)</span> 用所在范围内的元组唯一值统计</li>
</ul>
</li>
<li><span class="arithmatex">\(A\leq a\)</span><ul>
<li>0 如果 <span class="arithmatex">\(a&lt;\min(A,r)\)</span></li>
<li><span class="arithmatex">\(n_r\)</span> 如果 <span class="arithmatex">\(a\geq \max(A,r)\)</span></li>
<li><span class="arithmatex">\(n_r\frac{a-\min}{\max-\min}\)</span></li>
</ul>
</li>
<li>复杂选择<ul>
<li>conjunctive: 假设条件独立 <span class="arithmatex">\(n_r\frac{s_1s_2\dots s_n}{n_r^n}\)</span></li>
<li>disjunctive: <span class="arithmatex">\(n_r[1-(1-\frac{s_1}{n_r})\dots (1-\frac{s_n}{n_r})]\)</span></li>
<li>否定 <span class="arithmatex">\(n_r-s\)</span></li>
</ul>
</li>
</ul>
<h5 id="join-size">Join Size<a class="headerlink" href="#join-size" title="Locate to heading">#</a></h5>
<ul>
<li>natural join<ul>
<li><span class="arithmatex">\(R\cap S=\emptyset\)</span>，就是笛卡尔积，有 <span class="arithmatex">\(n_rn_s\)</span> 个元组，每个占用 <span class="arithmatex">\(l_r+l_s\)</span> 字节</li>
<li><span class="arithmatex">\(R\cap S=R\)</span>，每个 s 最多连接一个 r 元组，所以不超过 <span class="arithmatex">\(n_s\)</span></li>
<li><span class="arithmatex">\(R\cap S\)</span> 是 <span class="arithmatex">\(S\)</span> 中引用 <span class="arithmatex">\(R\)</span> 的外键，那么 <span class="arithmatex">\(n_s\)</span></li>
<li>交集不完全包括一个 schema 时<ul>
<li><span class="arithmatex">\(\min(\frac{n_rn_s}{V(A,r)},\frac{n_rn_s}{V(A,s)})\)</span></li>
</ul>
</li>
</ul>
</li>
<li>theta join<ul>
<li>按照笛卡尔积 + selection 计算</li>
</ul>
</li>
</ul>
<h5 id="other-operations_1">Other Operations<a class="headerlink" href="#other-operations_1" title="Locate to heading">#</a></h5>
<p><img alt="700x776" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613105713837.webp" /></p>
<h5 id="heuristics">Heuristics<a class="headerlink" href="#heuristics" title="Locate to heading">#</a></h5>
<ul>
<li>join 排序最优解<ul>
<li>dp time <span class="arithmatex">\(O(n^3)\)</span> space <span class="arithmatex">\(O(2^n)\)</span></li>
</ul>
</li>
<li>左深连接树<ul>
<li>time <span class="arithmatex">\(O(n!)\)</span> space <span class="arithmatex">\(O(2^n)\)</span></li>
<li>如果动态规划则是 time <span class="arithmatex">\(O(n2^n)\)</span> space <span class="arithmatex">\(O(2^n)\)</span></li>
</ul>
</li>
</ul>
<h2 id="transactions">Transactions<a class="headerlink" href="#transactions" title="Locate to heading">#</a></h2>
<h3 id="transactions_1">Transactions<a class="headerlink" href="#transactions_1" title="Locate to heading">#</a></h3>
<p><img alt="500" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613115631529.webp" /></p>
<ul>
<li>ACID<ul>
<li>Atomicity: 一个事务的所有操作要么全都成功，要么全都失败</li>
<li>Consistency: 事务的隔离执行保证了数据库的一致性</li>
<li>Isolation: 事务并发时，事务将不会观察到其他事务对数据库的操作或不一致状态</li>
<li>Durability: 事务执行完后，数据库状态应该持久化，即使遇到 system failure</li>
</ul>
</li>
<li>并发问题<ul>
<li>丢失修改：例如两个事务同时进行 -1 操作，读的一样，先后写回，只减了一次</li>
<li>读脏数据：A 读取了 B 在 rollback 前的修改后的数据</li>
<li>不可重复读：由于 B 的操作，A 在事务执行期间两次读同一个数据结果不一样</li>
<li>幽灵问题 Phantom Problem：由于 B 的 insert 操作，A 进行两次查询的结果不一致</li>
</ul>
</li>
<li>可串行化<ul>
<li>冲突可串行<ul>
<li>冲突的定义，例如同一位置的 r-w w-r w-w 是冲突</li>
<li>通过互换不冲突操作的顺序，实现完全串行</li>
<li>前驱图：<span class="arithmatex">\(T_i\rightarrow T_j\)</span> ，如果 Ti 和 Tj 冲突，且冲突操作 Ti 在 Tj 之前完成<ul>
<li>e.g. T1 read(A); T2 write(A); T1 write(A); 有两个冲突，对应 T1-&gt;T2 且 T2-&gt;T1，形成环</li>
<li>可以遍历数据项，每个数据项分析前驱关系，在图中添加边</li>
<li>每个数据项分析时，实际上需要考虑所有操作的两两组合，例如<ul>
<li>r1(A) w2(A) w1(A) r3(A)，考虑 C42</li>
</ul>
</li>
<li><mark>冲突可串行化等价于图中没有环</mark></li>
</ul>
</li>
</ul>
</li>
<li>视图可串行<ul>
<li>view equivalent on schedule A, B<ul>
<li>A 读 initial Q 的事务在 B 中也读 initial Q</li>
<li>A 中 Ti 在 Tj 修改后读 Q，B 中也要如此</li>
<li>A 中最后写 Q 的事务在 B 中也最后写 Q</li>
</ul>
</li>
<li><mark>所有 view serializable 但是不 conflict serivalizable 的事务，都一定有 blink writes</mark><ul>
<li>blind write 指的是没有读 Q 就写 Q</li>
</ul>
</li>
<li><mark>视图可串行的验证是 NP-C 的</mark>，大部分算法只检查一些充分条件，如果满足还能使用</li>
</ul>
</li>
<li><mark>和串行调度结果一致的调度，不一定满足冲突/视图，需要考虑除了 read/write 的其他操作</mark></li>
</ul>
</li>
<li>可恢复调度<ul>
<li><mark>如果 Tj 读了 Ti 写的数据，那么 Ti 就一定要先于 Tj 提交，才能保证可以恢复</mark> <strong>写先提交</strong></li>
<li>e.g. <img alt="400" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613114513879.webp" /><ul>
<li>如果 T8 rollback，T9 就已经访问了数据库的不一致状态，由于 T9 已经提交，这种不一致无法恢复</li>
</ul>
</li>
</ul>
</li>
<li>Cascading Rollbacks<ul>
<li>一个事务 abort 会导致一系列事务 rollback</li>
<li>e.g. <img alt="400" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613114907352.webp" /><ul>
<li>如果 T10 失败了，那么 T11, T12 也要回滚</li>
</ul>
</li>
<li><strong>Cascadeless Schedules</strong>: 不会产生级联回滚<ul>
<li><mark>对于每个 Ti Tj，如果 Tj 读了 Ti 写的数据，那么 Ti 应该在 Tj 读之前提交</mark> <strong>读前提交</strong> <em>比可恢复更加严格</em></li>
</ul>
</li>
</ul>
</li>
<li>SQL Isolation Level<ul>
<li>serializable: 可串行化</li>
<li>repeatable read: 可重复读，仅读取已经提交的数据，且事务两次读取的结果一致</li>
<li>read committed: 只能读取已经提交的数据</li>
<li>read uncommitted: 允许读取未提交的数据</li>
<li>所有等级都不允许 dirty write，即向李刚一个还没结束的事务写入的数据项进行操作 <em>需要锁</em></li>
</ul>
</li>
</ul>
<p><img alt="700x367" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613115353162.webp" /></p>
<h3 id="concurrency-control">Concurrency Control<a class="headerlink" href="#concurrency-control" title="Locate to heading">#</a></h3>
<h4 id="lock-based-protocol">Lock-Based Protocol<a class="headerlink" href="#lock-based-protocol" title="Locate to heading">#</a></h4>
<ul>
<li>锁兼容矩阵 <img alt="300" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613115935436.webp" /></li>
<li>deadlock<ul>
<li>e.g.<img alt="200" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613120110022.webp" /><ul>
<li>事务 A 申请了锁 a</li>
<li>事务 B 申请了锁 b，然后申请 a，不成功，于是阻塞，等待 A 释放 a</li>
<li>然而 A 的下一步操作不是释放 a，而是继续申请 b，于是相互等待</li>
</ul>
</li>
<li>starvation: 某个事务的锁申请一直没有被授予（竞争失败）</li>
</ul>
</li>
</ul>
<h5 id="2pl">2PL<a class="headerlink" href="#2pl" title="Locate to heading">#</a></h5>
<ul>
<li>vallina 2pl<ul>
<li>growing phase，事务只可以申请锁，或升级锁</li>
<li>shrinking phase，事务只可以释放锁，或降级锁</li>
<li>lock point：事务得到最后一个锁的时间，但不一定是事务开始进行数据处理的时间点<ul>
<li>可以按照 lock point 顺序得到冲突可串行调度</li>
</ul>
</li>
<li>效果<ul>
<li><mark>能够确保 conflict serializable，但不是所有 conflict serializable 调度都满足 2pl</mark><ul>
<li>即 2pl -&gt; conflict serializable，但不能反推</li>
</ul>
</li>
<li><mark>但是无法确保不发生死锁，无法确保无级联调度或可恢复调度</mark></li>
</ul>
</li>
</ul>
</li>
<li>strict 2pl: 所有事务只能在 commit/abort 之后释放其 X lock<ul>
<li><mark>能够保证可恢复调度、无级联调度</mark></li>
</ul>
</li>
<li>rigorous 2pl: 所有事务都只能在 commit/abort 之后释放锁<ul>
<li><mark>plus. 能够按照提交顺序得到串行调度</mark></li>
<li>大多数数据库都用</li>
</ul>
</li>
</ul>
<h5 id="lock-manager">Lock Manager<a class="headerlink" href="#lock-manager" title="Locate to heading">#</a></h5>
<p><img alt="300" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613121646186.webp" /></p>
<ul>
<li>在内存中维护一个锁表<ul>
<li>是一个 hash 表，管理数据项</li>
<li>每个数据项节点都有一个锁申请队列</li>
</ul>
</li>
</ul>
<h5 id="graph-based-protocol">Graph-Based Protocol<a class="headerlink" href="#graph-based-protocol" title="Locate to heading">#</a></h5>
<ul>
<li>强制偏序关系：<span class="arithmatex">\(d_i\rightarrow d_j\)</span>，那么同时访问两个数据的事务应当先访问 di 然后访问 dj<ul>
<li>这样，数据集合 D 可以称为一张有向无环图，称为 <strong>database graph</strong></li>
</ul>
</li>
<li>tree protocol<ul>
<li><mark>只允许申请 X lock</mark></li>
<li>Ti 第一个锁可以申请任何节点；其他时候，Ti 申请的锁，要求其父节点也已经被 Ti 申请到锁</li>
<li>锁可以在任何时间释放</li>
<li>一个数据项只能被加锁一次<ul>
<li>也就是 Ti 加锁然后释放的数据项，不能再被加锁</li>
</ul>
</li>
<li>效果<ul>
<li><mark>conflict serializable，没有死锁</mark></li>
<li>解锁可以比 2pl 更早发生（可以在任意时间解锁）<ul>
<li>更少的等待时间，更高的并发性</li>
<li>不会死锁，不会因为死锁 rollback</li>
</ul>
</li>
</ul>
</li>
<li>缺点<ul>
<li>无法确保可恢复或无级联<ul>
<li>需要引入 commit dependencies 来确保可恢复</li>
</ul>
</li>
<li>事务可能需要 lock 一些没用到的数据项<ul>
<li>提高了锁 overhead，增加等待时间，减少并发度</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>tree protocol 和 2pl 有交集，但差集均不为空<ul>
<li>2pl 不可能出现的调度可能在 tree 中出现，反之亦然</li>
</ul>
</li>
</ul>
<h4 id="deadlock-handling">Deadlock Handling<a class="headerlink" href="#deadlock-handling" title="Locate to heading">#</a></h4>
<ul>
<li>基础策略<ul>
<li>pre-declaration: 要求所有事务在开始执行前先获取所有锁</li>
<li>graph-based protocol 强制引入偏序关系</li>
</ul>
</li>
<li>其他策略<ul>
<li>wait-die (non-preemptive 非抢占) older 等待 younger 释放锁，younger 不等待 older，rollback</li>
<li>wound-wait (preemptive 抢占)<ul>
<li>older 强制 younger rollback，而不是等待</li>
<li>younger 可能会等待 older</li>
<li>rollback 次数比 wait-die 要少</li>
</ul>
</li>
<li>
<div class="list-callouts list-callouts-warning"><span>上面两种 rollback 之后新事务的时间戳仍然用原来的，保证其会变成 older，避免饥饿</span></div>
</li>
</ul>
</li>
<li>timeout-based<ul>
<li>一个事务等待的时间有限制，超出这个时间则 rollback，能够确保死锁在 timeout 的时间内解决</li>
<li>效果<ul>
<li>实现比较简单</li>
<li>但是可能在没有死锁发生时也进行 rollback</li>
<li>starvation 仍然可能出现</li>
</ul>
</li>
</ul>
</li>
<li>detection<ul>
<li>wait-for graph: Ti-&gt;Tj 如果 Ti 正在等待 Tj 释放锁，有环时死锁</li>
<li>死锁恢复策略<ul>
<li>victim: rollback 后能解决死锁的事务中选出的，开销最小的一个</li>
<li>total rollback: 将这个事务完全 rollback</li>
<li>partial rollback: 只 rollback 到需要的位置</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="multiple-granularity">Multiple Granularity<a class="headerlink" href="#multiple-granularity" title="Locate to heading">#</a></h4>
<ul>
<li>fine / coarse</li>
<li>database - area - file - record</li>
<li>intention lock modes: 在较低的节点加锁时，往较高的节点放置一个意向锁，减少较高节点申请锁时的检查，表示这里有/将要有一个锁<ul>
<li>intention-shared (IS) 表示在树的较低级别有显式锁定，有节点加上了 s lock</li>
<li>intention-exclusive (IX) 表示在数的较低级别有显式锁定，可以是 x / s lock</li>
<li>shared and intention-exclusive (SIX) 复合锁，表示当前节点显式锁定 s lock，且较低级别存在 x lock</li>
<li><img alt="400" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613133852406.webp" /></li>
</ul>
</li>
<li>规则：当 T 希望给节点 Q 加锁时<ul>
<li>T 先前没有解锁过时，T 才能对节点加锁</li>
<li>T 必须先对树的根节点加锁</li>
<li>仅当 T 给 Q 的父亲加上 xx 锁时，T 才能给 Q 加上 xx 锁<ul>
<li>IX IS -&gt; S IS</li>
<li>IX SIX - &gt; X SIX IX</li>
</ul>
</li>
<li>T 没有对 Q 的任何孩子加锁时，才可以解锁 Q</li>
</ul>
</li>
<li>总结<ul>
<li>加锁 top-down，解锁 bottom-up</li>
<li><mark>无法保证不发生死锁</mark></li>
</ul>
</li>
</ul>
<p><img alt="700x717" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613134655274.webp" /></p>
<h4 id="insert-delete">Insert / Delete<a class="headerlink" href="#insert-delete" title="Locate to heading">#</a></h4>
<ul>
<li>locking<ul>
<li>删除前必须有 x lock</li>
<li>插入后自动获得 x lock</li>
</ul>
</li>
<li>phantom phenomenon<ul>
<li>一个解决方案：加入一个 data item 表示整张表<ul>
<li>scan 需要 s lock</li>
<li>insert delete 需要 x lock</li>
<li>但是 low concurrency</li>
</ul>
</li>
<li>indexing locking protocol <mark>能够保证 phantom 不会发生，并发度受限</mark><ul>
<li>每张表都至少有一个 index</li>
<li>仅当通过表上的一个或多个 index 找到 tuple 时，Ti 才能访问这些元组</li>
<li>索引协议中，表的扫描被视为叶子的扫描</li>
<li>执行查找事务的 Ti 必须对要访问的索引叶子节点加上共享锁，即使访问到的叶子节点中并没有符合要求的 tuple</li>
<li>一个进行插入、删除、更新的事务，必须对所有有影响的 leaf 节点加锁</li>
<li>遵循 2pl</li>
</ul>
</li>
<li>next key locking protocol <mark>提供更高的并发度</mark><ul>
<li>在 index lookup 中，锁定所有满足条件的 value</li>
<li>而且也锁定 index 中的下一个 key value</li>
<li>查找用 s lock，插入更新删除用 x lock</li>
</ul>
</li>
</ul>
</li>
<li>同时更新不可串行例子 <img alt="400" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613135042431.webp" /></li>
</ul>
<h3 id="recovery">Recovery<a class="headerlink" href="#recovery" title="Locate to heading">#</a></h3>
<ul>
<li>Log<ul>
<li>存储在稳定存储器上，通过多备份确保不会损坏</li>
<li>log 先写原则</li>
<li>当 commit log 写入稳定存储器时，txn 才算 commit，而事务的更新仍然可能在 buffer 中</li>
</ul>
</li>
<li>undo<ul>
<li>undo 时写 compensation log</li>
<li>undo 结束 abort</li>
</ul>
</li>
<li>redo 不用写 log</li>
</ul>
<h4 id="vallina-algorithm">Vallina Algorithm<a class="headerlink" href="#vallina-algorithm" title="Locate to heading">#</a></h4>
<ul>
<li>ckpt<ul>
<li>将所有 log record 持久化</li>
<li>将所有脏页持久化</li>
<li>写 ckpt，包括 ATT</li>
<li>其他事务都停止，阻塞式检查点</li>
</ul>
</li>
<li>rollback<ul>
<li>backwards 扫描</li>
<li>undo writing，写补偿日志</li>
<li>遇到 start 写 abort</li>
</ul>
</li>
<li>recovery from failure<ul>
<li>redo scan forward, 更新 undo-list</li>
<li>undo scan backwards，进行 undo，写补偿 log，直到 empty</li>
</ul>
</li>
</ul>
<h4 id="buffer-management">Buffer Management<a class="headerlink" href="#buffer-management" title="Locate to heading">#</a></h4>
<ul>
<li>log buffer 在一个 block 满/log force 永久化时永久化</li>
<li>在 commit 被输出到 stable storage 时，T 才算 commit</li>
<li>当主存中部分数据块输出时，确保这个数据块相关的 log 已经永久化 write-ahead logging WAL</li>
<li>对于 database 管理数据块的方法<ul>
<li>no-force policy: commit 的时候数据块不用永久化</li>
<li>steal policy: 还没 commit 的时候也可能持久化</li>
<li>持久化过程中加上 latch (x lock on block)，不允许修改</li>
</ul>
</li>
<li><mark>output a block</mark><ul>
<li>申请 block 的 latch</li>
<li>log flush</li>
<li>output block</li>
<li>release latch</li>
</ul>
</li>
</ul>
<h4 id="fuzzy-ckpt">Fuzzy Ckpt<a class="headerlink" href="#fuzzy-ckpt" title="Locate to heading">#</a></h4>
<ul>
<li>过程<ul>
<li>暂时停止所有事务的更新</li>
<li>插入 ckpt L 并强制 log 永久化</li>
<li>记录 buffer pool 中的 modified blocks 到 list M</li>
<li>允许事务继续执行</li>
<li>输出 M 中的所有脏页<ul>
<li>WAL + 输出时不更新</li>
</ul>
</li>
<li>在 disk 上保存一个 ptr，指向 ckpt record</li>
</ul>
</li>
<li>效果<ul>
<li><mark>能够 handle incomplete ckpt，即数据库在 ckpt 时 crase</mark></li>
<li>能提升并发度</li>
</ul>
</li>
</ul>
<h4 id="early-lock-release-and-operation-logging">Early Lock Release and Operation Logging<a class="headerlink" href="#early-lock-release-and-operation-logging" title="Locate to heading">#</a></h4>
<ul>
<li>logical undo logging<ul>
<li>类似 bptree 插入和删除的操作无法物理 undo，只能逻辑 undo</li>
</ul>
</li>
<li>operation logging<ul>
<li><code>&lt;Ti, Oi, operation-begin&gt;  ...  &lt;Ti, Oi, operation-end, U&gt;</code></li>
<li>其中的 U 是整个 operation 的逻辑操作，例如 <code>delete I9, K5, RID7</code></li>
<li>rollback 流程：backwards<ul>
<li>如果遇到普通 log，进行物理 undo，写补偿日志</li>
<li>如果遇到 <code>&lt;Ti, Oj, operation-end, U&gt;</code><ul>
<li>使用 undo info in U 进行逻辑 undo</li>
<li>此时也要正常记录 operation log，但在结尾用 <code>&lt;Ti, Oj, operation-abort&gt;</code> 而不是 operation-end</li>
<li>跳过 Ti 的所有日志，直到遇到 <code>&lt;Ti, Oj, operation-begin&gt;</code></li>
</ul>
</li>
<li>如果遇到 redo-only log，忽略</li>
<li>如果遇到 <code>&lt;Ti, Oj, operatoin-abort&gt;</code> 跳过 Ti 的所有日志，直到找到 <code>&lt;Ti, Oj, operation-begin&gt;</code></li>
<li>如果遇到 <code>&lt;Ti, start&gt;</code> 停止扫描</li>
<li>在 log 结尾添加 <code>&lt;Ti, abort&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img alt="700x493" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613150603234.webp" /></p>
<p><img alt="700x539" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613150825826.webp" /></p>
<h4 id="aries">ARIES<a class="headerlink" href="#aries" title="Locate to heading">#</a></h4>
<ul>
<li>优势<ul>
<li>physiological redo<ul>
<li>影响到的 page 是 physically identified，page 上的 action 可以是 logical 的</li>
</ul>
</li>
<li>DPT，减少不必要的 redo</li>
<li>fuzy ckpt，只用记录 DPT 而不用永久化 dirty page</li>
</ul>
</li>
<li>basic concepts<ul>
<li>LSN log sequence number</li>
<li>DPT dirty page table，能够避免不必要的 redo 操作<ul>
<li>RecLSN 本页加入 DPT 时的 log record<ul>
<li>用于减少 redo work</li>
</ul>
</li>
<li>PageLSN 在本页更新的最后一条 log LSN<ul>
<li>update a page: X latch; write log; update page; record PageLSN; unlock</li>
<li>flush a page: S latch then write</li>
<li>在 recovery 中避免重复 redo</li>
</ul>
</li>
</ul>
</li>
<li>ATT: | TxnID | LastLSN |</li>
<li>log record<ul>
<li>basic: | LSN | TransID | PrevLSN | RedoInfo | UndoInfo |</li>
<li>CLR(compensation): | LSN | TransID | UndoNextLSN | RedoInfo |<ul>
<li>在 rollback 时写，不需要 undo，可以通过 UndoNextLSN 快速找到下一个需要 undo 的 log</li>
<li><img alt="400" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613151835548.webp" /></li>
</ul>
</li>
</ul>
</li>
<li>ckpt: DPT + ATT<ul>
<li>overhead 很小，可以经常做</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img alt="500" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250613152056074.webp" /></p>
<ol>
<li>analysis pass<ol>
<li>根据 DPT 的 RecLSN 决定 RedoLSN，取最小的，如果 DPT 空则取 ckpt 的 LSN</li>
<li>从 ckpt 开始 forward 扫描，更新 ATT 中的 Transaction 和 LastLSN，DPT 中新加页的 PageID PageLSN 和 RecLSN</li>
</ol>
</li>
<li>redo pass，从 RedoLSN 开始 forward 扫描<ul>
<li>如果目标页在 DPT 中且当前 LSN 大于其 RecLSN，则从硬盘中读取该页，进行对应操作 <em>也就是，这一页在崩溃时没有刷盘，且现在的操作是这一页最后一次 fetch 之后的操作</em></li>
<li>否则跳过</li>
</ul>
</li>
<li>undo pass，从最后开始 backward 扫描，分析阶段的 ATT 中存储了崩溃时每一个事务的 LastLSN<ul>
<li>选择 UndoLSN，在需要 undo 的所有事务中，取 UndoLSN 最大的，本质上是按照 backward 的顺序进行的</li>
<li>每当遇到一条属于 ATT 中需要回滚的事务的 Update Log Record，进行反向操作，并记录 CLR(Compensation Log Record)，将这条 CLR 的 UndoNextLSN 设置为这条日志记录的 PrevLSN <em>也就是，如果需要再次 undo，可以直接跳过到这条日志记录的前一条，中间的操作已经抵消</em></li>
<li>确定下一条回滚事务 LSN<ul>
<li>如果当前事务是 CLR，取 UndoNextLSN</li>
<li>否则取 PrevLSN</li>
</ul>
</li>
<li>直到 undo list empty</li>
</ul>
</li>
</ol>
<p><img alt="500" src="__assets/DB%20Cheatsheet/IMG-DB%20Cheatsheet-20250607171307170.webp" /></p>
<h2 id="复习课">复习课<a class="headerlink" href="#复习课" title="Locate to heading">#</a></h2>
<ul>
<li>关系代数 2<ul>
<li>符号的含义，等价转换</li>
<li>细节别看错</li>
</ul>
</li>
<li>SQL 3-4<ul>
<li>集合操作，聚合函数 Avg Sum Count Min Max，增删改，distinct</li>
<li>尽量不用嵌套</li>
<li>一般不涉及第五章的内容</li>
</ul>
</li>
<li>E-R 6<ul>
<li>判断题</li>
<li>mapping cardinality, participant constraints(total or partial) 什么含义，怎么画</li>
<li>箭头、双线、虚线、标注</li>
</ul>
</li>
<li>normalization 7<ul>
<li>ppt 上的例题</li>
<li>无损分解：分解后 join 等于原来的，或者分解后两个表交集包括其中一个表的 candidate key</li>
<li>正则覆盖：等价于 F；没有无关属性；左侧是不同的，否则可以合并</li>
<li>BCNF 更常用，但是无法依赖保持，3NF 更松，且以来保持<ul>
<li>BCNF：对于所有依赖，alpha -&gt; beta，要么 trivial 要么 alpha 是 superkey<ul>
<li>分解：alpha union beta；R-(beta - alpha)</li>
<li>分解伪代码</li>
<li>是无损分解，但不确保依赖保持的</li>
</ul>
</li>
<li>3NF：多一个条件，beta - alpha 的每一个 attr 都在 R 中一个 candidate key 中<ul>
<li>保证无损和依赖保持</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>storage 12<ul>
<li>三级存储，二级是 flash, magnetic disk，三级是 tape, 光盘</li>
<li>磁盘结构<ul>
<li>多层，每层同步读同一个扇区</li>
<li>最小的传输单位是 block/page</li>
<li>外侧扇区多，外道读写速率高</li>
<li>读取时，先寻道，然后等扇区旋转后读取</li>
<li>Access time: 发出指令到第一个字节开始输出的时间<ul>
<li>seek time</li>
<li>rotational latency</li>
</ul>
</li>
<li>Data transfer rate: 外圈快</li>
</ul>
</li>
</ul>
</li>
<li>storage structure 13<ul>
<li>变长度<ul>
<li>record（起始位置、大小）null bitmap</li>
<li>slotted-page structure: [block header -&gt; || free space || &lt;records]</li>
</ul>
</li>
<li>organization of records<ul>
<li>heap, seq, b+, hash 这个有点不熟</li>
</ul>
</li>
</ul>
</li>
<li>indexing 14<ul>
<li>index record (search key, pointer)</li>
<li>ordered indices<ul>
<li>clustering, secondary, dense, sparse 等概念</li>
<li>辅助索引只能是稠密的，但是辅助索引的二级索引可以是稀疏的！</li>
</ul>
</li>
<li>B+ 树代价分析数学表达，树大小估计</li>
<li>LSM Buffer</li>
</ul>
</li>
<li>query processing 15<ul>
<li>selection A1-A10，A1 更加通用且不一定就最差</li>
<li>sorting 外部排序，分配 <span class="arithmatex">\(b_b\)</span> 个 buffer block，减少寻址次数</li>
<li>join: nested-loop join, blocked nested-loop join, merge join, hash join<ul>
<li>merge join 先排序再 join</li>
</ul>
</li>
</ul>
</li>
<li>query optimization 16<ul>
<li>逻辑等价表达式，<strong>有十几条等价规则要看一遍</strong></li>
<li>select join 结果大小估计方法<ul>
<li>select<ul>
<li>selection size:L 等于和小于关系的元组数量估计，以及= key attr 怎么选都是 1</li>
<li>selectivity 选择率</li>
</ul>
</li>
<li>join ... 反正要复习</li>
</ul>
</li>
<li>启发式方法：push selection, push projection, push most restrictive selection and join；但不一定真的就更好，要具体分析</li>
</ul>
</li>
<li>transactions 17<ul>
<li>acid serializability recoverability</li>
<li>conflict, conflict serializability, precedence graph 等价可串行化调度不一定唯一<ul>
<li>每一个 view 可串行化的调度如果不是 conflict 可串行化的，那么一定有 blind write</li>
</ul>
</li>
<li>recoverable: Tj 读了 Ti 的数据，那么 Ti 在 Tj 之前 commit</li>
<li>cascadeless: Ti 在 Tj 读之前 commit</li>
</ul>
</li>
<li>concurrency control 18<ul>
<li>2pl, lock point, growing/shrinking 可能死锁</li>
<li>strict 2pl 严格，X lock 持有到 commit</li>
<li>rigrous 2pl 增强，所有 lock 持有到 commit</li>
<li><strong>画一个图来表示上述的性质、概念空间</strong></li>
<li>tree protocol: 只用了排他锁，本身不会出现死锁，保证冲突可串行</li>
<li>死锁：等待死亡、受伤等待模式，等待图</li>
</ul>
</li>
<li>recovery 19</li>
</ul>







  
  





<!--  -->
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="DB%2019%20Recovery%20System.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 19 Recovery System">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                19 Recovery System
              </div>
            </div>
          </a>
        
        
          
          <a href="../index/cv_cg/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: CV/CG">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                CV/CG
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2025 <a href="https://github.com/EmergentTwilight">EmergentTwilight</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/EmergentTwilight" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:travischengzju@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "navigation.tracking", "navigation.tabs", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../__srcs/javascript/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
        <script src="../__srcs/javascript/toc.js"></script>
      
    
  </body>
</html>