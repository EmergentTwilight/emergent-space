
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Emergent Space">
      
      
        <meta name="author" content="Emergent Twilight">
      
      
        <link rel="canonical" href="https://note.emergenttwilight.top/GAMES101/GAMES101%2007%20Ray%20Tracing.html">
      
      
        <link rel="prev" href="GAMES101%2006%20Geometry.html">
      
      
        <link rel="next" href="GAMES101%2008%20Materials%20and%20Appearances.html">
      
      
      <link rel="icon" href="../__srcs/images/logo-E.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>07 Ray Tracing - Emergent Space</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../__srcs/css/banner.css">
    
      <link rel="stylesheet" href="../__srcs/css/sidebar.css">
    
      <link rel="stylesheet" href="../__srcs/css/content.css">
    
      <link rel="stylesheet" href="../__srcs/css/custom.css">
    
      <link rel="stylesheet" href="../__srcs/css/font.css">
    
      <link rel="stylesheet" href="../__srcs/css/list_callouts.css">
    
      <link rel="stylesheet" href="../__srcs/css/friend_link.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Emergent Space" class="md-header__button md-logo" aria-label="Emergent Space" data-md-component="logo">
      
  <img src="../__srcs/images/logo-gaussian-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Emergent Space
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              07 Ray Tracing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EmergentTwilight/emergent-space/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    emergent-space
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index.html" class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ZJU-Fundamentals%20of%20Data%20Structures/index.html" class="md-tabs__link">
          
  
    
  
  DS/Algo.

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ZJU-Assembly%20Fundamentals/index.html" class="md-tabs__link">
          
  
    
  
  Coding/Lang.

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="index.html" class="md-tabs__link">
          
  
    
  
  Others

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Emergent Space" class="md-nav__button md-logo" aria-label="Emergent Space" data-md-component="logo">
      
  <img src="../__srcs/images/logo-gaussian-small.png" alt="logo">

    </a>
    Emergent Space
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EmergentTwilight/emergent-space/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    emergent-space
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Home
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../ZJU-Fundamentals%20of%20Data%20Structures/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    DS/Algo.
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../ZJU-Assembly%20Fundamentals/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Coding/Lang.
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Others
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Others
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    GAMES101
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            GAMES101
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2001%20Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2002%20A%20Swift%20and%20Brutal%20Introduction%20to%20Linear%20Algebra.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 About Linear Algebra
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2003%20Transformation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 Transformation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2004%20Rasterization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 Resterization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2005%20Shading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 Shading
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2006%20Geometry.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 Geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    07 Ray Tracing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="GAMES101%2007%20Ray%20Tracing.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    07 Ray Tracing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intro">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#light-rays" class="md-nav__link">
    <span class="md-ellipsis">
      Light Rays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray-casting" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Casting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursive-whitted-style-ray-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Recursive (Whitted-Style) Ray Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recursive (Whitted-Style) Ray Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray-equation" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Equation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray-intersection" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Intersection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ray Intersection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-sphere" class="md-nav__link">
    <span class="md-ellipsis">
      with sphere
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-implicit-surface" class="md-nav__link">
    <span class="md-ellipsis">
      with implicit surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-single-triangle" class="md-nav__link">
    <span class="md-ellipsis">
      with single triangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-triangle-mesh" class="md-nav__link">
    <span class="md-ellipsis">
      with triangle mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spatial-partioning" class="md-nav__link">
    <span class="md-ellipsis">
      Spatial Partioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-partition-bounding-volume-hierarchy-bvh" class="md-nav__link">
    <span class="md-ellipsis">
      Object Partition &amp; Bounding Volume Hierarchy (BVH)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-radiometry-辐射度量学" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Radiometry (辐射度量学)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Radiometry (辐射度量学)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#radiant-energy-and-flux-power" class="md-nav__link">
    <span class="md-ellipsis">
      Radiant Energy and Flux (Power)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Radiant Energy and Flux (Power)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Basic concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#irradiance-vs-radiance" class="md-nav__link">
    <span class="md-ellipsis">
      Irradiance vs. Radiance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bidirectional-reflectance-distribution-function-brdf" class="md-nav__link">
    <span class="md-ellipsis">
      Bidirectional Reflectance Distribution Function (BRDF)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bidirectional Reflectance Distribution Function (BRDF)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-reflection-equation" class="md-nav__link">
    <span class="md-ellipsis">
      The Reflection Equation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rendering-equation" class="md-nav__link">
    <span class="md-ellipsis">
      The Rendering Equation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Path Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Path Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monte-carlo-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Monte Carlo Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solve-rendering-equation" class="md-nav__link">
    <span class="md-ellipsis">
      Solve Rendering Equation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solve Rendering Equation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Direct Illumination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-tracing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Path Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Path Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-noise-control" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1: Noise Control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2: Recursion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-problem-path-tracing-is-not-efficient" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Problem: Path Tracing is not efficient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Problem: Path Tracing is not efficient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-light" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling the light
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#light-source-vs-other" class="md-nav__link">
    <span class="md-ellipsis">
      light source v.s. other
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outro" class="md-nav__link">
    <span class="md-ellipsis">
      Outro
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2008%20Materials%20and%20Appearances.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 Materials and Appearances
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2009%20Advanced%20Topics%20in%20Rendering.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 Advanced Topics in Rendering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2010%20Cameras%2C%20Lenses%20and%20Light%20Fields.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 Cameras, Lenses and Light Fields
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2011%20Color%20and%20Perception.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 Color and Perception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GAMES101%2012%20Animation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 Animation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../ZJU-HPC101/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    HPC101
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intro">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#light-rays" class="md-nav__link">
    <span class="md-ellipsis">
      Light Rays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray-casting" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Casting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursive-whitted-style-ray-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Recursive (Whitted-Style) Ray Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recursive (Whitted-Style) Ray Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray-equation" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Equation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray-intersection" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Intersection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ray Intersection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-sphere" class="md-nav__link">
    <span class="md-ellipsis">
      with sphere
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-implicit-surface" class="md-nav__link">
    <span class="md-ellipsis">
      with implicit surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-single-triangle" class="md-nav__link">
    <span class="md-ellipsis">
      with single triangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-triangle-mesh" class="md-nav__link">
    <span class="md-ellipsis">
      with triangle mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spatial-partioning" class="md-nav__link">
    <span class="md-ellipsis">
      Spatial Partioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-partition-bounding-volume-hierarchy-bvh" class="md-nav__link">
    <span class="md-ellipsis">
      Object Partition &amp; Bounding Volume Hierarchy (BVH)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-radiometry-辐射度量学" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Radiometry (辐射度量学)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Radiometry (辐射度量学)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#radiant-energy-and-flux-power" class="md-nav__link">
    <span class="md-ellipsis">
      Radiant Energy and Flux (Power)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Radiant Energy and Flux (Power)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Basic concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#irradiance-vs-radiance" class="md-nav__link">
    <span class="md-ellipsis">
      Irradiance vs. Radiance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bidirectional-reflectance-distribution-function-brdf" class="md-nav__link">
    <span class="md-ellipsis">
      Bidirectional Reflectance Distribution Function (BRDF)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bidirectional Reflectance Distribution Function (BRDF)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-reflection-equation" class="md-nav__link">
    <span class="md-ellipsis">
      The Reflection Equation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rendering-equation" class="md-nav__link">
    <span class="md-ellipsis">
      The Rendering Equation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Path Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Path Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monte-carlo-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Monte Carlo Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solve-rendering-equation" class="md-nav__link">
    <span class="md-ellipsis">
      Solve Rendering Equation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solve Rendering Equation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Direct Illumination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-tracing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Path Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Path Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-noise-control" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1: Noise Control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2: Recursion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-problem-path-tracing-is-not-efficient" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Problem: Path Tracing is not efficient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Problem: Path Tracing is not efficient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling-the-light" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling the light
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#light-source-vs-other" class="md-nav__link">
    <span class="md-ellipsis">
      light source v.s. other
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outro" class="md-nav__link">
    <span class="md-ellipsis">
      Outro
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/EmergentTwilight/emergent-space/edit/master/docs/GAMES101/GAMES101 07 Ray Tracing.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/EmergentTwilight/emergent-space/raw/master/docs/GAMES101/GAMES101 07 Ray Tracing.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


  <h1>07 Ray Tracing</h1>

<h2 id="intro">Intro<a class="headerlink" href="#intro" title="Locate to heading">#</a></h2>
<div class="admonition question">
<p class="admonition-title">why ray tracing? rasterization couldn't handle <strong>global</strong> effects well</p>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208230353287.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208230353287.webp" /></p>
<ul>
<li>soft shadow</li>
<li>glossy reflection</li>
<li>indirect illumination</li>
</ul>
</div>
<ul>
<li>Ray tracing s accurate, but <strong>very slow</strong><ul>
<li>rasterization: real-time, ray tracing: <strong>offline</strong></li>
</ul>
</li>
</ul>
<h3 id="light-rays">Light Rays<a class="headerlink" href="#light-rays" title="Locate to heading">#</a></h3>
<ol>
<li>沿直线传播</li>
<li>不会相互碰撞</li>
<li>从光源到相机，可逆性 (reciprocity)</li>
</ol>
<h3 id="ray-casting">Ray Casting<a class="headerlink" href="#ray-casting" title="Locate to heading">#</a></h3>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208231323111.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208231323111.webp" /></p>
<ol>
<li>对每个像素投射一束光线</li>
<li>光线遇到场景中的一个点，判断这个点是否对光源可见</li>
<li>依据光照情况，渲染像素颜色</li>
</ol>
<div class="admonition bug">
<p class="admonition-title">problem</p>
<p>仍然忽略了折射</p>
</div>
<h2 id="recursive-whitted-style-ray-tracing">Recursive (Whitted-Style) Ray Tracing<a class="headerlink" href="#recursive-whitted-style-ray-tracing" title="Locate to heading">#</a></h2>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208231531988.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208231531988.webp" /></p>
<h3 id="ray-equation">Ray Equation<a class="headerlink" href="#ray-equation" title="Locate to heading">#</a></h3>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208231655764.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208231655764.webp" /></p>
<div class="arithmatex">\[\begin{aligned}
\mathbf{r}(t)=\mathbf{o}+t\mathbf{d}\quad0\leq t&lt;\infty
\end{aligned}\]</div>
<h3 id="ray-intersection">Ray Intersection<a class="headerlink" href="#ray-intersection" title="Locate to heading">#</a></h3>
<h4 id="with-sphere">with sphere<a class="headerlink" href="#with-sphere" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208232045614.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208232045614.webp" /></p>
<p>$$</p>
<p>\begin{cases}</p>
<p>\mathbf{r}(t)=\mathbf{o}+t\mathbf{d}\quad0\leq t&lt;\infty \</p>
<p>(\mathbf{p}-\mathbf{c})^2-R^2=0</p>
<p>\end{cases}\implies</p>
<p>(\mathbf{o}+t\mathbf{d}-\mathbf{c})^2-R^2=0</p>
<p>$$</p>
<p>然后计算二次方程：</p>
<div class="arithmatex">\[\begin{aligned}
 &amp; at^{2}+bt+c=0,\mathrm{where} \\
 &amp; a=\mathbf{d}\cdot\mathbf{d} \\
 &amp; b=2(\mathbf{o-c})\cdot\mathbf{d} \\
 &amp; c=(\mathbf{o}-\mathbf{c})\cdot(\mathbf{o}-\mathbf{c})-R^2 \\
 &amp; t=\frac{-b\pm\sqrt{b^{2}-4ac}}{2a}
\end{aligned}\]</div>
<h4 id="with-implicit-surface">with implicit surface<a class="headerlink" href="#with-implicit-surface" title="Locate to heading">#</a></h4>
<p>$$</p>
<p>\begin{cases}</p>
<p>\mathbf{r}(t)=\mathbf{o}+t\mathbf{d}\quad0\leq t&lt;\infty \</p>
<p>f(\mathbf{p})=0</p>
<p>\end{cases}\implies</p>
<p>f(\mathbf{o}+t\mathbf{d})=0</p>
<p>$$</p>
<h4 id="with-single-triangle">with single triangle<a class="headerlink" href="#with-single-triangle" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208232609966.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208232609966.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>与三角形所在平面相交</li>
<li>判断交点是否在三角形内</li>
</ol>
</div>
<h5 id="plane-equation">Plane Equation<a class="headerlink" href="#plane-equation" title="Locate to heading">#</a></h5>
<div class="admonition note">
<p class="admonition-title">plane equation</p>
<p><span class="arithmatex">\(\mathbf{p}:(\mathbf{p}-\mathbf{p}^{\prime})\cdot\mathbf{N}=0 \implies ax+by+cz+d=0\)</span></p>
</div>
<div class="arithmatex">\[\begin{aligned}
 &amp; \mathrm{Set~}\mathbf{p}=\mathbf{r}(t)\text{ and solve for }t \\
 &amp; (\mathbf{p}-\mathbf{p}^{\prime})\cdot\mathbf{N}=(\mathbf{o}+t\mathbf{d}-\mathbf{p}^{\prime})\cdot\mathbf{N}=0 \\
 &amp; t=\frac{(\mathbf{p}^{\prime}-\mathbf{o})\cdot\mathbf{N}}{\mathbf{d}\cdot\mathbf{N}} &amp; \mathrm{Check:~}0\leq t&lt;\infty
\end{aligned}\]</div>
<h5 id="moller-trumbore-algorithm">Moller Trumbore Algorithm<a class="headerlink" href="#moller-trumbore-algorithm" title="Locate to heading">#</a></h5>
<blockquote>
<p>直接求解重心坐标，判断是否有 <span class="arithmatex">\(1-b_{1}-b_{2},b_{1},b_{2}\geq0\)</span></p>
</blockquote>
<div class="arithmatex">\[\begin{align}
\vec{\mathbf{O}}+t\vec{\mathbf{D}}&amp;=(1-b_{1}-b_{2})\vec{\mathbf{P}}_{0}+b_{1}\vec{\mathbf{P}}_{1}+b_{2}\vec{\mathbf{P}}_{2} \\
\implies \begin{bmatrix}
t \\
b_1 \\
b_2
\end{bmatrix}&amp;=\frac{1}{\vec{\mathbf{S}}_1\bullet\vec{\mathbf{E}}_1}
\begin{bmatrix}
\vec{\mathbf{S}}_2\bullet\vec{\mathbf{E}}_2 \\
\vec{\mathbf{S}}_1\bullet\vec{\mathbf{S}} \\
\vec{\mathbf{S}}_2\bullet\vec{\mathbf{D}}
\end{bmatrix} \\
\text{where }&amp; \begin{cases}
 &amp; \mathbf{\vec{E}}_{1}=\mathbf{\vec{P}}_{1}-\mathbf{\vec{P}}_{0} \\
 &amp; \mathbf{\vec{E}}_{2}=\mathbf{\vec{P}}_{2}-\mathbf{\vec{P}}_{0} \\
 &amp; \mathbf{\vec{S}}=\mathbf{\vec{O}}-\mathbf{\vec{P}}_{0} \\
 &amp; \mathbf{\vec{S}}_{1}=\mathbf{\vec{D}}\times\mathbf{\vec{E}}_{2} \\
 &amp; \mathbf{\vec{S}}_{2}=\mathbf{\vec{S}}\times\mathbf{\vec{E}}_{1}
\end{cases}
\end{align}\]</div>
<h4 id="with-triangle-mesh">with triangle mesh<a class="headerlink" href="#with-triangle-mesh" title="Locate to heading">#</a></h4>
<div class="admonition failure">
<p class="admonition-title">naive solution</p>
<p>每个三角形面都判断光线是否过三角形</p>
</div>
<h5 id="bounding-volumes">Bounding Volumes<a class="headerlink" href="#bounding-volumes" title="Locate to heading">#</a></h5>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208233728965.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208233728965.webp" /></p>
<blockquote>
<p>如果光线和包围盒不相交，一定不会与盒中的物体相交</p>
</blockquote>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208233829665.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208233829665.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Axis-Aligned Bounding Box (AABB)</p>
<ul>
<li>任何一个面都是与坐标轴面平行的</li>
<li>横平竖直的平面求解交点更加方便</li>
</ul>
</div>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250208234048076.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250208234048076.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>分别求出穿过三组对面的 <span class="arithmatex">\(t_{\text{min}},t_{\text{max}}\)</span></li>
<li>求交集 <span class="arithmatex">\(t_{\text{enter}}=\max\{t_{\text{min}}\}, t_{{\text{exit}}}=\min\{t_{\text{max}}\}\)</span><ul>
<li>最晚进入一个对面的时间是进入盒子时间</li>
<li>最早离开一个对面的时间是离开盒子时间</li>
</ul>
</li>
<li>如果 <span class="arithmatex">\(t_{\text{enter}}&lt;t_{\text{exit}}\)</span>，那么相交</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">ray is not a line</p>
<ul>
<li><span class="arithmatex">\(t_{\text{exit}}&lt;0\)</span>，盒子在光线后面，不会相交</li>
<li><span class="arithmatex">\(t_{\text{exit}}\geq 0, t_{\text{enter}}&lt;0\)</span>，光源在盒子里面</li>
<li><span class="arithmatex">\(t_{\text{exit}}\geq 0,t_{\text{enter}}&lt;t_{\text{exit}}\)</span>，那么相交</li>
</ul>
</div>
<h5 id="uniform-spatial-partitions-grids">Uniform Spatial Partitions (Grids)<a class="headerlink" href="#uniform-spatial-partitions-grids" title="Locate to heading">#</a></h5>
<div class="admonition note">
<p class="admonition-title">假设</p>
<ul>
<li>与 AABB 的求交非常快</li>
<li>与物体的求交相对较慢</li>
</ul>
</div>
<h6 id="preprocess-build-acceleration-grid">Preprocess - Build Acceleration Grid<a class="headerlink" href="#preprocess-build-acceleration-grid" title="Locate to heading">#</a></h6>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209114027667.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209114027667.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>找到一个大的包围盒</li>
<li>内部划分网格</li>
<li>记录有物体的网格</li>
</ol>
</div>
<h6 id="process">Process<a class="headerlink" href="#process" title="Locate to heading">#</a></h6>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209114225610.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209114225610.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>光线与一个盒子相交时，下一个相交的盒子只可能是右边或者上面的格子</li>
<li>直到与有物体的盒子相交时，进行与物体相交求解</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">performance</p>
<ul>
<li>格子太稀疏，或者格子太密集，加速效果都不好</li>
<li><span class="arithmatex">\(\#\text{cells}=C\cdot\#\text{objs}, C\approx 27\text{ in 3D}\)</span></li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">performance</p>
<ul>
<li>物体分布均匀时，效率高</li>
<li>空的部分太多时，效率低</li>
</ul>
</div>
<h4 id="spatial-partioning">Spatial Partioning<a class="headerlink" href="#spatial-partioning" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209114941589.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209114941589.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>Oct-Tree: 一直划分，直到格子里的物体数量小于阈值</li>
<li><strong>KD-Tree</strong>: 分别垂直于 x y z 轴进行递归划分</li>
<li>BSP-Tree: 维度高的时候计算复杂</li>
</ul>
</div>
<h5 id="kd-tree">KD-Tree<a class="headerlink" href="#kd-tree" title="Locate to heading">#</a></h5>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209115354716.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209115354716.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Huffman Tree，在中间节点存储子节点指针</p>
</div>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209115723593.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209115723593.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>与一个节点的 AABB 有交点，则需要判断与其子节点是否有交点，直到叶子节点</li>
<li>判断与最小叶子节点内物体是否有交点</li>
</ul>
</div>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<ul>
<li>判断一个三角形与 AABB 相交比较复杂，即使三个顶点都不在盒子内，也可能相交</li>
<li>一个物体可能和不同的盒子都有交集，会出现在多个叶子节点里</li>
</ul>
</div>
<h4 id="object-partition-bounding-volume-hierarchy-bvh">Object Partition &amp; Bounding Volume Hierarchy (BVH)<a class="headerlink" href="#object-partition-bounding-volume-hierarchy-bvh" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209120540919.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209120540919.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>将 bounding box 内的物体划分为两个部分，重新计算 bounding box，直到叶子节点有足够少的三角形</li>
<li>bounding box 可能相交，重叠部分越小越好</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">how to subdivide?</p>
<ul>
<li>choose a dimension to split</li>
<li>heuristic #1: 总是分割最长的轴</li>
<li>heuristic #2: split node at location of <strong>median</strong> object, 让两边的三角形个数相近</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>场景变化后，要重新计算 BVH</p>
</div>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209121159818.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209121159818.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>实际应用中 BVH 的应用更加广泛</p>
</div>
<h2 id="basic-radiometry-辐射度量学">Basic Radiometry (辐射度量学)<a class="headerlink" href="#basic-radiometry-辐射度量学" title="Locate to heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">motivation</p>
<p>要让场景更加真实，需要精确地定义光的属性，不能随便定义各种参数</p>
</div>
<h3 id="radiant-energy-and-flux-power">Radiant Energy and Flux (Power)<a class="headerlink" href="#radiant-energy-and-flux-power" title="Locate to heading">#</a></h3>
<h4 id="basic-concepts">Basic concepts<a class="headerlink" href="#basic-concepts" title="Locate to heading">#</a></h4>
<p><strong>Radiant Energy</strong>: 电磁辐射的能量</p>
<div class="arithmatex">\[Q\text{ [J = Joule]}\]</div>
<p><strong>Radiant Flux (power)</strong>: 单位时间辐射能量 <em>#photons flowing through a sensor in unit time</em></p>
<div class="arithmatex">\[\Phi\equiv\frac{\mathrm{d}Q}{\mathrm{d}t}\mathrm{[W=Watt]}\mathrm{[lm=lumen]}^{\star}\]</div>
<p><strong>Radiant Intensity</strong>: the power per unit solid angle (立体角)</p>
<p><img alt="300" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209122251585.webp" /></p>
<div class="arithmatex">\[\begin{aligned}
I(\omega)  \equiv\frac{\mathrm{d}\Phi}{\mathrm{d}\omega} 
\left[\frac{\mathrm{W}}{\mathrm{sr}}\right]\left[\frac{\mathrm{lm}}{\mathrm{sr}}  =\mathrm{cd}=\mathrm{candela}\right]
\end{aligned}\]</div>
<div class="admonition note">
<p class="admonition-title">angles and solid andgles</p>
<ul>
<li><span class="arithmatex">\(\theta=\frac{l}{r}\)</span> 弧长除以半径</li>
<li><span class="arithmatex">\(\Omega =\frac{A}{r^2}\)</span> 面积除以半径平方</li>
<li>微分立体角，整个球的立体角为 <span class="arithmatex">\(4\pi\)</span> <img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209122518664.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209122518664.webp" /></li>
<li>后面会用 <span class="arithmatex">\(\omega\)</span> 来表示一个单位长度的方向向量</li>
</ul>
</div>
<p>对于一个向所有方向均匀辐射的点光源，<span class="arithmatex">\(I=\frac{\Phi}{4\pi}\)</span></p>
<p><strong>Irradiance</strong>: power per unit area</p>
<p><img alt="500" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209142520786.webp" /></p>
<div class="arithmatex">\[E(\mathbf{x})\equiv\frac{\mathrm{d}\Phi(\mathbf{x})}{\mathrm{d}A}\left[\frac{\mathrm{W}}{\mathrm{m}^{2}}\right]\left[\frac{\mathrm{lm}}{\mathrm{m}^{2}}=\mathrm{lux}\right]\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209142651048.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209142651048.webp" /></p>
<blockquote>
<p>需要考虑 cosine law</p>
</blockquote>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>回忆平方反比，其实 intensity(单位立体角上的功率) 没有衰减，是 irradiance(单位面积接收能量) 在衰减</p>
</div>
<p><strong>Radiance(Luminance)</strong>: power <em>per unit solid angle, per projected unit area</em></p>
<p><img alt="400" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209143033139.webp" /></p>
<div class="arithmatex">\[L(\mathrm{p},\omega) \equiv\frac{\mathrm{d}^2\Phi(\mathrm{p},\omega)}{\mathrm{d}\omega \mathrm{d}A\cos\theta} \left[\frac{\mathrm{W}}{\mathrm{sr} \mathrm{m}^2}\right]\left[\frac{\mathrm{cd}}{\mathrm{m}^2}=\frac{\mathrm{lm}}{\mathrm{sr} \mathrm{m}^2}=\mathrm{nit}\right]\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>下面的 cos 表示 <span class="arithmatex">\(\omega\)</span> 方向上的投影面积</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>一次微分<ul>
<li>Irradiance: power per projected unit area</li>
<li>Intensity: power per solid angle</li>
</ul>
</li>
<li>两次微分<ul>
<li>Radiance: Irradiance per solid angle</li>
<li>Radiance: Intensity per projected unit area</li>
</ul>
</li>
</ul>
</div>
<p><strong>Exiting Radiance</strong>: 和 Radiance 一样，但是发出的能量</p>
<p><img alt="400" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209143033139.webp" /></p>
<div class="arithmatex">\[L(\mathrm{p},\omega)=\frac{\mathrm{d}I(\mathrm{p},\omega)}{\mathrm{d}A\cos\theta}\]</div>
<h4 id="irradiance-vs-radiance">Irradiance vs. Radiance<a class="headerlink" href="#irradiance-vs-radiance" title="Locate to heading">#</a></h4>
<p><img alt="400" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209143859604.webp" /></p>
<ul>
<li>Irradiance: 面积微元 <span class="arithmatex">\(\mathrm{d}A\)</span> 上接收的总能量</li>
<li>Radiance: 面积微元 <span class="arithmatex">\(\mathrm{d}A\)</span> 从 <span class="arithmatex">\(\mathrm{d}\omega\)</span> 方向上接收到的能量</li>
</ul>
<div class="arithmatex">\[\begin{aligned}
dE(\mathrm{p},\omega) &amp; =L_i(\mathrm{p},\omega)\cos\theta\mathrm{d}\omega \\
E(\mathrm{p}) &amp; =\int_{H^2}L_i(\mathrm{p},\omega)\cos\theta\mathrm{d}\omega
\end{aligned}\]</div>
<h3 id="bidirectional-reflectance-distribution-function-brdf">Bidirectional Reflectance Distribution Function (BRDF)<a class="headerlink" href="#bidirectional-reflectance-distribution-function-brdf" title="Locate to heading">#</a></h3>
<blockquote>
<p>双向反射分布函数
从 <span class="arithmatex">\(\omega_{i}\)</span> 来的 Radiance 打到 <span class="arithmatex">\(\mathrm{d}A\)</span> 上，能量 <span class="arithmatex">\(E\)</span> 转化到反射光线中，给出了反射光线的分布</p>
</blockquote>
<p><img alt="500" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209144248942.webp" /></p>
<ul>
<li>differential irradiance incoming (入射 irradiance): <span class="arithmatex">\(\mathrm{d}E(\omega_{i})=L(\omega_{i})\cos \theta_{i}\mathrm{d}\omega_{i}\)</span></li>
<li>differential radiance exiting (due to <span class="arithmatex">\(\mathrm{d}E(\omega_{i})\)</span>): <span class="arithmatex">\(\mathrm{d}L_{r}(\omega_{r})\)</span></li>
</ul>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209150621727.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209150621727.webp" /></p>
<div class="arithmatex">\[\text{BRDF: }f_r(\omega_i\to\omega_r)=\frac{\mathrm{d}L_r(\omega_r)}{\mathrm{d}E_i(\omega_i)}=\frac{\mathrm{d}L_r(\omega_r)}{L_i(\omega_i)\cos\theta_i\mathrm{d}\omega_i}\left[\frac{1}{\text{sr}}\right]\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>将漫反射和镜面反射一起考虑</p>
</div>
<h4 id="the-reflection-equation">The Reflection Equation<a class="headerlink" href="#the-reflection-equation" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209150923077.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209150923077.webp" /></p>
<div class="arithmatex">\[\text{The Reflection Equation: }L_r(\mathrm{p},\omega_r)=\int_{H^2}f_r(\mathrm{p},\omega_i\to\omega_r)L_i(\mathrm{p},\omega_i)\cos\theta_i\mathrm{d}\omega_i\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>将所有可能的入射方向积分，得到观测方向的能量</p>
</div>
<div class="admonition question">
<p class="admonition-title">challenge: recursive equation</p>
<p>光线可能弹射多次，一个面积微元的入射光可能来自另一个面积微元</p>
</div>
<h4 id="the-rendering-equation">The Rendering Equation<a class="headerlink" href="#the-rendering-equation" title="Locate to heading">#</a></h4>
<blockquote>
<p>考虑物体本身的发光，重写 reflection eqation</p>
</blockquote>
<div class="arithmatex">\[\text{The Rendering Equation: }L_o(p,\omega_o)=\underbrace{   L_e(p,\omega_o)}_{\text{emitted by the object itself}}+\int_{\Omega^+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i)\mathrm{d}\omega_i\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>假设所有的向量都是向外的</li>
<li><span class="arithmatex">\(\cos \theta=n\cdot w_{i}\)</span></li>
</ul>
</div>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209152239723.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209152239723.webp" /></p>
<p>进行简化：</p>
<p>$$</p>
<p>\begin{align}</p>
<p>\to &amp;&amp; l(u)&amp;=e(u)+\int l(v)K(u,v)dv \</p>
<p>\to &amp;&amp; L&amp;=E+KL</p>
<p>\end{align}</p>
<p>$$</p>
<p>这里的 <span class="arithmatex">\(L\)</span> 是全局光照(Global Illimination)</p>
<p>$$</p>
<p>\begin{align}</p>
<p>L&amp;=E+KL \</p>
<p>(I-K)L&amp;=E \</p>
<p>L&amp;=(I-K)^{-1}E \</p>
<p>L&amp;=(I+K+K^2+K^3+\dots)E \</p>
<p>L&amp;=E+KE+K^2E+K^3E+\dots</p>
<p>\end{align}</p>
<p>$$</p>
<p><img alt="400" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209153405715.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>光线弹射0、1、2、... 次得到的光照</li>
<li>rasterization 最多考虑了一次弹射(direct illumination)，也就是 <span class="arithmatex">\(E+KE\)</span></li>
<li>考虑无限次光线弹射，最终亮度会收敛</li>
</ul>
</div>
<h2 id="path-tracing">Path Tracing<a class="headerlink" href="#path-tracing" title="Locate to heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Whitted-Style recap: 不准确的估计</p>
<ul>
<li>遇到光滑面，考虑镜面反射光线</li>
<li>遇到漫反射面，不考虑反射光线
<img alt="400" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209155403176.webp" /></li>
</ul>
</div>
<h3 id="monte-carlo-integration">Monte Carlo Integration<a class="headerlink" href="#monte-carlo-integration" title="Locate to heading">#</a></h3>
<div class="admonition question">
<p class="admonition-title">why</p>
<p>we want to solve an integral, but it can be too difficult to solve analytically.</p>
</div>
<p>对于定积分 <span class="arithmatex">\(\int_{a}^b f(x)\mathrm{d}x\)</span>，取随机变量 <span class="arithmatex">\(X_i\sim p(x)\)</span>，则 Monte Carlo Integration 为：</p>
<div class="arithmatex">\[\int f(x)\mathrm{d}x\approx\frac{1}{N}\sum_{i=1}^{N}\frac{f(X_i)}{p(X_i)}\]</div>
<p>一种特殊情况是平均分布 <span class="arithmatex">\(X_{i}\sim p(x)=\frac{1}{b-a}\)</span>：</p>
<div class="arithmatex">\[F_N=\frac{b-a}{N}\sum_{i=1}^Nf(X_i)\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>采样越多，方差越小</li>
<li>在 x 上积分，就在 x 上采样</li>
</ul>
</div>
<h3 id="solve-rendering-equation">Solve Rendering Equation<a class="headerlink" href="#solve-rendering-equation" title="Locate to heading">#</a></h3>
<div class="arithmatex">\[\text{The Rendering Equation: }L_o(p,\omega_o)=\underbrace{   L_e(p,\omega_o)}_{\text{emitted by the object itself}}+\int_{\Omega^+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i)\mathrm{d}\omega_i\]</div>
<div class="admonition question">
<p class="admonition-title">challenge</p>
<ul>
<li>在半球面上积分</li>
<li>recursive execution</li>
</ul>
</div>
<h4 id="direct-illumination">Direct Illumination<a class="headerlink" href="#direct-illumination" title="Locate to heading">#</a></h4>
<p>考虑要渲染一个像素(pixel, point)的 direct illumination</p>
<div class="arithmatex">\[L_o(p,\omega_o)=\int_{\Omega^+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i)\mathrm{d}\omega_i\]</div>
<p>使用 Monte Carlo 进行采样</p>
<p>$$</p>
<p>\begin{align}</p>
<p>f(x)\text{ in Monte Carlo} &amp; =L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i) \</p>
<p>p(\omega_{i})\text{ in Monte Carlo}&amp;=&frac12;\pi</p>
<p>\end{align}</p>
<p>$$</p>
<p>得到</p>
<div class="arithmatex">\[\begin{aligned}
L_{o}(p,\omega_{o}) &amp; =\int_{\Omega^+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i)\mathrm{d}\omega_i \\
 &amp; \approx\frac{1}{N}\sum_{i=1}^N\frac{L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i)}{p(\omega_i)}
\end{aligned}\]</div>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">direct illumination</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a>shade(p, wo)
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>    Randomly choose N directions wi~pdf(w)
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a>    Lo = 0.0
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a>    For each wi
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a>        Trace a ray r(p, wi)
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a>        If ray r hit the light
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a>            Lo += (1 / N) * L_i * f_r * cosine / pdf(wi)
</span></code></pre></div></td></tr></table></div>
<h4 id="global-illumination">Global Illumination<a class="headerlink" href="#global-illumination" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209160458378.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209160458378.webp" /></p>
<div class="admonition note">
<p class="admonition-title">递归特性</p>
<p>Q 反射到 P 的光线，相当于从 P 点看 Q 点的 direct illumination</p>
</div>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">global illumination</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a>shade(p, wo)
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>    Randomly choose N directions wi~pdf(w)
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a>    Lo = 0.0
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a>    For each wi
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a>        Trace a ray r(p, wi)
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a>        If ray r hit the light
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a>            Lo += (1 / N) * L_i * f_r * cosine / pdf(wi)
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="hll">        Else If ray r hit an object at q:
</span></span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="hll">            Lo += (1 / N) * shade(q, -wi) * f_r * cosine / pdf(wi)
</span></span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a>    Return Lo
</span></code></pre></div></td></tr></table></div>
<h3 id="path-tracing_1">Path Tracing<a class="headerlink" href="#path-tracing_1" title="Locate to heading">#</a></h3>
<div class="admonition question">
<p class="admonition-title">done? <strong>NO</strong></p>
<ul>
<li>光线数量爆炸 <span class="arithmatex">\(\#\text{rays}=N^{\#\text{bounces}}\)</span></li>
<li>只有 <span class="arithmatex">\(N=1\)</span> 的时候，不会爆炸</li>
</ul>
</div>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">global illumination, path tracing</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>shade(p, wo)
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="hll">    Randomly choose ONE directions wi~pdf(w)
</span></span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a>    Trace a ray r(p, wi)
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a>    If ray r hit the light
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a>        Return L_i * f_r * cosine / pdf(wi)
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a>    Else If ray r hit an object at q:
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a>        Return shade(q, -wi) * f_r * cosine / pdf(wi)
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a>    Return Lo
</span></code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Path Tracing 就是 <span class="arithmatex">\(N=1\)</span> 的情况，如果 <span class="arithmatex">\(N\neq 1\)</span>，称为 Distributed Ray Tracing</p>
</div>
<h4 id="problem-1-noise-control">Problem 1: Noise Control<a class="headerlink" href="#problem-1-noise-control" title="Locate to heading">#</a></h4>
<div class="admonition question">
<p class="admonition-title">too noisy?</p>
<p><img alt="400" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209161451325.webp" /></p>
<blockquote>
<p>multiple paths，求平均</p>
</blockquote>
</div>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">global illumination, path tracing, multiple paths</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span>
<span class="normal"><a href="#__codelineno-3-7">7</a></span>
<span class="normal"><a href="#__codelineno-3-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>ray_generation(camPos, pixel)
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="hll">    Uniformly choose N sample positions within the pixel
</span></span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="hll">    pixel_radiance = 0.0
</span></span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="hll">    For each sample in the pixel
</span></span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a>        Shoot a ray r(camPos, cam_to_sample)
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a>        If ray r hit the scene at p
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a>            pixel_radience += 1 / N * shade(p, sample_to_cam)
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a>    Return pixel_radiance
</span></code></pre></div></td></tr></table></div>
<h4 id="problem-2-recursion">Problem 2: Recursion<a class="headerlink" href="#problem-2-recursion" title="Locate to heading">#</a></h4>
<div class="admonition note">
<p class="admonition-title">Russian Roulette (RR)</p>
<ul>
<li>with probability <span class="arithmatex">\(0&lt;p&lt;1\)</span>, continue</li>
<li>with probability <span class="arithmatex">\(1-p\)</span>, stop</li>
<li>期望进行 <span class="arithmatex">\(\frac{1}{1-p}\)</span> 次</li>
</ul>
</div>
<ul>
<li>一个点接收到一个光线后：<ul>
<li>以 <span class="arithmatex">\(p\)</span> 的概率继续发射光线追踪，得到 <span class="arithmatex">\(L_{o}/p\)</span> （人为除以 <span class="arithmatex">\(p\)</span>）</li>
<li>以 <span class="arithmatex">\(1-p\)</span> 的概率不追踪，得到 <span class="arithmatex">\(0\)</span></li>
<li>那么期望是 <span class="arithmatex">\(E=p \cdot (L_{o}/p)+(1-p)\cdot 0=L_{o}\)</span>，期望与真实值一样！</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">global illumination, path tracing</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a>shade(p, wo)
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="hll">    Manually specify a probability P_RR
</span></span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="hll">    Randomly select ksi in a uniform dist. in [0, 1]
</span></span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a>    If (ksi &gt; P_RR) Return 0.0
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a>    Randomly choose ONE directions wi~pdf(w)
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a>    Trace a ray r(p, wi)
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a>    If ray r hit the light
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="hll">        Return L_i * f_r * cosine / pdf(wi) / P_RR
</span></span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a>    Else If ray r hit an object at q:
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="hll">        Return shade(q, -wi) * f_r * cosine / pdf(wi) / P_RR
</span></span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a>    Return Lo
</span></code></pre></div></td></tr></table></div>
<h3 id="advanced-problem-path-tracing-is-not-efficient">Advanced Problem: Path Tracing is not efficient<a class="headerlink" href="#advanced-problem-path-tracing-is-not-efficient" title="Locate to heading">#</a></h3>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209163433507.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209163433507.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SPP(samples per pixel) 足够大，效果才能好，但是效率会变低</p>
</div>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209163559166.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209163559166.webp" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>光源大的时候，并不需要太多光线</li>
<li>光源小的时候，需要很多光线</li>
<li>均匀向所有方向采样，会造成浪费，需要用非均匀的 PDF</li>
</ul>
</div>
<h4 id="sampling-the-light">Sampling the light<a class="headerlink" href="#sampling-the-light" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209164153725.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209164153725.webp" /></p>
<div class="admonition note">
<p class="admonition-title">如何实现对光源采样？</p>
<ul>
<li>渲染方程在半球上积分，光源采样在光源 <span class="arithmatex">\(A\)</span> 上积分 <span class="arithmatex">\(p=1/A\)</span></li>
<li>需要找到 <span class="arithmatex">\(A\)</span> 和 <span class="arithmatex">\(\omega\)</span> 的关系找到，将 Monte Carlo 写成在 <span class="arithmatex">\(A\)</span> 上采样</li>
</ul>
</div>
<p>根据立体角关系得到：</p>
<div class="arithmatex">\[d\omega=\frac{dA\cos\theta^{\prime}}{\|x^{\prime}-x\|^2}\]</div>
<p>改变积分域：</p>
<div class="arithmatex">\[\begin{aligned}
L_o(x,\omega_o) &amp; =\int_{\Omega^+}L_i(x,\omega_i)f_r(x,\omega_i,\omega_o)\cos\theta\mathrm{d}\omega_i \\
 &amp; =\int_AL_i(x,\omega_i)f_r(x,\omega_i,\omega_o)\frac{\cos\theta\cos\theta^{\prime}}{\|x^{\prime}-x\|^2}\mathrm{d}A
\end{aligned}\]</div>
<h4 id="light-source-vs-other">light source v.s. other<a class="headerlink" href="#light-source-vs-other" title="Locate to heading">#</a></h4>
<p><img alt="./__assets/GAMES101 07 Ray Tracing/IMG-GAMES101 07 Ray Tracing-20250209164717749.webp" src="__assets/GAMES101%2007%20Ray%20Tracing/IMG-GAMES101%2007%20Ray%20Tracing-20250209164717749.webp" /></p>
<div class="admonition note">
<p class="admonition-title">分成两部分考虑</p>
<ul>
<li>光源部分直接在光源上采样，不用使用 RR</li>
<li>其他部分仍然使用 RR</li>
</ul>
</div>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">sampling the light</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a>shade(p, wo)
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="hll">    # Contribution from the light source.
</span></span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a>    L_dir = 0.0
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a>    Uniformly sample the light at x&#39; (pdf_light = 1 / A)
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="hll">    Shoot a ray from p to x&#39;
</span></span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="hll">    If the ray is not blocked in the middle
</span></span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a>        L_dir = L_i * f_r * cos theta * cos theta&#39; / |x&#39;-p| ^ 2 / pdf_light
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="hll">    # Contribution from other reflections
</span></span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a>    L_indir = 0.0
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a>    Test Russian Roulette with probability P_RR
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a>    Uniformly sample the hemishpere toward wi (pdf_hemi = 1 / 2pi)
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a>    Trace a ray r(p, wi)
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a>    If ray r hit a non-emiting object at q
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a>        L_indir = shade(q, -wi) * f_r * cos theta / pdf_hemi / P_RR
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="hll">    Return L_dir + L_indir
</span></span></code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>注意光源采样时，要保证光源不被遮挡</p>
</div>
<h2 id="outro">Outro<a class="headerlink" href="#outro" title="Locate to heading">#</a></h2>
<ul>
<li>Path Tracing is <strong>PHOTO-REALISTIC</strong></li>
<li>Ray tracing: Previous v.s. Modern Concepts<ul>
<li>previous<ul>
<li>ray tracing == Whitted-style ray tracing</li>
</ul>
</li>
<li>modern<ul>
<li><strong>The general solution fo light transport</strong></li>
<li>path tracing</li>
<li>photon mapping</li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li>
<div class="list-callouts list-callouts-question"><span>how to uniformly sample the hemisphere?</span></div>
</li>
<li>
<div class="list-callouts list-callouts-question"><span>what's the best pdf?</span></div>
</li>
<li>random number matters(low discrepancy sequences)</li>
<li>结合 hemishpere 和 light 两种采样方法，可以得到更好的效果</li>
<li>radiance 不是 color，需要经过 gamma correction 才能得到 rgb color</li>
</ul>







  
  






  <h2 id="__comments">Comments</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
          data-repo="EmergentTwilight/Emergent-Space"
          data-repo-id="R_kgDOMQFYhw"
          data-category="Announcements"
          data-category-id="DIC_kwDOMQFYh84Cmb5p"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="top"
          data-theme="preferred_color_scheme"
          data-lang="zh-CN"
          crossorigin="anonymous"
          async>
  </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="GAMES101%2006%20Geometry.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 06 Geometry">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                06 Geometry
              </div>
            </div>
          </a>
        
        
          
          <a href="GAMES101%2008%20Materials%20and%20Appearances.html" class="md-footer__link md-footer__link--next" aria-label="Next: 08 Materials and Appearances">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                08 Materials and Appearances
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2025 <a href="https://github.com/EmergentTwilight">EmergentTwilight</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/EmergentTwilight" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:emergentshores@outlook.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "navigation.tracking", "navigation.tabs", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../__srcs/javascript/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
        <script src="../__srcs/javascript/toc.js"></script>
      
    
  </body>
</html>